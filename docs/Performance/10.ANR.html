
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>10.ANR · 知识总结</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="11.启动优化.html" />
    
    
    <link rel="prev" href="1.Android优化大全.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Algorithmic
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../Algorithmic/BinarySearch 二分法查找.html">
            
                <a href="../Algorithmic/BinarySearch 二分法查找.html">
            
                    
                    BinarySearch 二分法查找
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../Algorithmic/Sort.html">
            
                <a href="../Algorithmic/Sort.html">
            
                    
                    Sort
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../Algorithmic/Stack-用两个栈实现队列.html">
            
                <a href="../Algorithmic/Stack-用两个栈实现队列.html">
            
                    
                    Stack-用两个栈实现队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../Algorithmic/String-手写一个字符串翻转.html">
            
                <a href="../Algorithmic/String-手写一个字符串翻转.html">
            
                    
                    String-手写一个字符串翻转
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../Algorithmic/二叉树.html">
            
                <a href="../Algorithmic/二叉树.html">
            
                    
                    二叉树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../Algorithmic/数组单独的数.html">
            
                <a href="../Algorithmic/数组单独的数.html">
            
                    
                    数组单独的数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../Algorithmic/数组实现队列.html">
            
                <a href="../Algorithmic/数组实现队列.html">
            
                    
                    数组实现队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../Algorithmic/生产者消费者模型.html">
            
                <a href="../Algorithmic/生产者消费者模型.html">
            
                    
                    生产者消费者模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../Algorithmic/链表.html">
            
                <a href="../Algorithmic/链表.html">
            
                    
                    链表
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Android
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Android/1-01.组件-Activity.html">
            
                <a href="../Android/1-01.组件-Activity.html">
            
                    
                    1-01.组件-Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Android/1-02.组件-Service.html">
            
                <a href="../Android/1-02.组件-Service.html">
            
                    
                    1-02.组件-Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Android/1-03.组件-BroadCast.html">
            
                <a href="../Android/1-03.组件-BroadCast.html">
            
                    
                    1-03.组件-BroadCast
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Android/1-04.组件-ContentProvider.html">
            
                <a href="../Android/1-04.组件-ContentProvider.html">
            
                    
                    1-04.组件-ContentProvider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../Android/1-05.组件-Fragment.html">
            
                <a href="../Android/1-05.组件-Fragment.html">
            
                    
                    1-05.组件-Fragment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../Android/2-01.Binder.html">
            
                <a href="../Android/2-01.Binder.html">
            
                    
                    2-01.Binder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../Android/2-02.Context.html">
            
                <a href="../Android/2-02.Context.html">
            
                    
                    2-02.Context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../Android/2-03.framework-Android消息机制.html">
            
                <a href="../Android/2-03.framework-Android消息机制.html">
            
                    
                    2-03.framework-Android消息机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../Android/2-04.IdleHandler.html">
            
                <a href="../Android/2-04.IdleHandler.html">
            
                    
                    2-04.IdleHandler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../Android/2-05.多线程模型.html">
            
                <a href="../Android/2-05.多线程模型.html">
            
                    
                    2-05.多线程模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="../Android/3-01.View-绘制流程.html">
            
                <a href="../Android/3-01.View-绘制流程.html">
            
                    
                    3-01.View-绘制流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="../Android/3-02.View-事件分发.html">
            
                <a href="../Android/3-02.View-事件分发.html">
            
                    
                    3-02.View-事件分发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="../Android/3-03.View-面试题.html">
            
                <a href="../Android/3-03.View-面试题.html">
            
                    
                    3-03.View-面试题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="../Android/3-04.自定义view CustomView.html">
            
                <a href="../Android/3-04.自定义view CustomView.html">
            
                    
                    3-04.自定义view CustomView
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="../Android/Android概述.html">
            
                <a href="../Android/Android概述.html">
            
                    
                    Android概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="../Android/Binder IPC.html">
            
                <a href="../Android/Binder IPC.html">
            
                    
                    Binder IPC
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Android Kernel
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Android kernel/Android系统分区.html">
            
                <a href="../Android kernel/Android系统分区.html">
            
                    
                    Android系统分区
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Android kernel/Linux基础.html">
            
                <a href="../Android kernel/Linux基础.html">
            
                    
                    Linux基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../Android kernel/Zram.html">
            
                <a href="../Android kernel/Zram.html">
            
                    
                    Zram
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../Android kernel/安全.html">
            
                <a href="../Android kernel/安全.html">
            
                    
                    安全
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Debug
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Debug/ADB.html">
            
                <a href="../Debug/ADB.html">
            
                    
                    ADB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../Debug/binder_sample日志.html">
            
                <a href="../Debug/binder_sample日志.html">
            
                    
                    binder_sample日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../Debug/minicom 串口调试.md">
            
                <span>
            
                    
                    minicom 串口调试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../Debug/Systrace.html">
            
                <a href="../Debug/Systrace.html">
            
                    
                    Systrace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../Debug/Tombstone.html">
            
                <a href="../Debug/Tombstone.html">
            
                    
                    Tombstone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../Debug/内存.md">
            
                <span>
            
                    
                    内存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../Debug/制作开机动画.html">
            
                <a href="../Debug/制作开机动画.html">
            
                    
                    制作开机动画
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Frame Work
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../FrameWork/Activity finish(">
            
                <span>
            
                    
                    Activity Finish
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../FrameWork/AMS_kill.html">
            
                <a href="../FrameWork/AMS_kill.html">
            
                    
                    AMS Kill
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../FrameWork/AMS_watchDog.html">
            
                <a href="../FrameWork/AMS_watchDog.html">
            
                    
                    AMS Watch Dog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../FrameWork/Android内存回收.html">
            
                <a href="../FrameWork/Android内存回收.html">
            
                    
                    Android内存回收
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../FrameWork/Anroid 权限 .html">
            
                <a href="../FrameWork/Anroid 权限 .html">
            
                    
                    Anroid 权限 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../FrameWork/ANR分析.html">
            
                <a href="../FrameWork/ANR分析.html">
            
                    
                    ANR分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../FrameWork/apk打包.html">
            
                <a href="../FrameWork/apk打包.html">
            
                    
                    apk打包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../FrameWork/build.prop system.prop default.prop 与 SystemProperty.html">
            
                <a href="../FrameWork/build.prop system.prop default.prop 与 SystemProperty.html">
            
                    
                    build.prop system.prop default.prop 与 SystemProperty
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../FrameWork/image.html">
            
                <a href="../FrameWork/image.html">
            
                    
                    Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../FrameWork/makefile.html">
            
                <a href="../FrameWork/makefile.html">
            
                    
                    Makefile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../FrameWork/MediaPlayer 播放流程.html">
            
                <a href="../FrameWork/MediaPlayer 播放流程.html">
            
                    
                    MediaPlayer 播放流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../FrameWork/OTA.html">
            
                <a href="../FrameWork/OTA.html">
            
                    
                    OTA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../FrameWork/PhoneWindowManager需求处理.html">
            
                <a href="../FrameWork/PhoneWindowManager需求处理.html">
            
                    
                    PhoneWindowManager需求处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../FrameWork/PKMS_安装流程.html">
            
                <a href="../FrameWork/PKMS_安装流程.html">
            
                    
                    PKMS_安装流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../FrameWork/Root su权限.html">
            
                <a href="../FrameWork/Root su权限.html">
            
                    
                    Root su权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../FrameWork/WMS_ViewRootImpl.html">
            
                <a href="../FrameWork/WMS_ViewRootImpl.html">
            
                    
                    WMS View Root Impl
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../FrameWork/WMS_窗口加载.html">
            
                <a href="../FrameWork/WMS_窗口加载.html">
            
                    
                    WMS_窗口加载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../FrameWork/WMS工作原理.html">
            
                <a href="../FrameWork/WMS工作原理.html">
            
                    
                    WMS工作原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../FrameWork/定屏分析.html">
            
                <a href="../FrameWork/定屏分析.html">
            
                    
                    定屏分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="../FrameWork/开机流程.html">
            
                <a href="../FrameWork/开机流程.html">
            
                    
                    开机流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.21" data-path="../FrameWork/沙箱机制.html">
            
                <a href="../FrameWork/沙箱机制.html">
            
                    
                    沙箱机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.22" data-path="../FrameWork/系统编译.html">
            
                <a href="../FrameWork/系统编译.html">
            
                    
                    系统编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.23" data-path="../FrameWork/系统裁剪.html">
            
                <a href="../FrameWork/系统裁剪.html">
            
                    
                    系统裁剪
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.24" data-path="../FrameWork/进程启动.html">
            
                <a href="../FrameWork/进程启动.html">
            
                    
                    进程启动
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Java
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../Java/1-01.java内存分区.html">
            
                <a href="../Java/1-01.java内存分区.html">
            
                    
                    1-01.java内存分区
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../Java/1-03.Java内存模型  原子性 、 可见性 、 有序性 、CAS happens-before 原子类.html">
            
                <a href="../Java/1-03.Java内存模型  原子性 、 可见性 、 有序性 、CAS happens-before 原子类.html">
            
                    
                    1-03.Java内存模型  原子性 、 可见性 、 有序性 、CAS happens-before 原子类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../Java/1-04.Java类加载.html">
            
                <a href="../Java/1-04.Java类加载.html">
            
                    
                    1-04.Java类加载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../Java/1-05.Java GC 垃圾回收.html">
            
                <a href="../Java/1-05.Java GC 垃圾回收.html">
            
                    
                    1-05.Java GC 垃圾回收
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../Java/1-06.接口、抽象类.html">
            
                <a href="../Java/1-06.接口、抽象类.html">
            
                    
                    1-06.接口、抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../Java/1-07.Java 动态代理 静态代理.md.html">
            
                <a href="../Java/1-07.Java 动态代理 静态代理.md.html">
            
                    
                    1-07.Java 动态代理 静态代理.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../Java/1-08.Java反射.html">
            
                <a href="../Java/1-08.Java反射.html">
            
                    
                    1-08.Java反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../Java/1-09.java 异常.html">
            
                <a href="../Java/1-09.java 异常.html">
            
                    
                    1-09.java 异常
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../Java/2-01.锁.html">
            
                <a href="../Java/2-01.锁.html">
            
                    
                    2-01.锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../Java/2-02.Volatile.html">
            
                <a href="../Java/2-02.Volatile.html">
            
                    
                    2-02.Volatile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../Java/2-03.Synchronized.html">
            
                <a href="../Java/2-03.Synchronized.html">
            
                    
                    2-03.Synchronized
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../Java/2-04-1.线程分类、状态、创建、阻塞.html">
            
                <a href="../Java/2-04-1.线程分类、状态、创建、阻塞.html">
            
                    
                    2-04-1.线程分类、状态、创建、阻塞
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../Java/2-04-2.线程中断.html">
            
                <a href="../Java/2-04-2.线程中断.html">
            
                    
                    2-04-2.线程中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../Java/2-04-3.线程间协作.html">
            
                <a href="../Java/2-04-3.线程间协作.html">
            
                    
                    2-04-3.线程间协作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../Java/2-05.线程池.html">
            
                <a href="../Java/2-05.线程池.html">
            
                    
                    2-05.线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.16" data-path="../Java/2-06.ThreadLocal.html">
            
                <a href="../Java/2-06.ThreadLocal.html">
            
                    
                    2-06.ThreadLocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.17" data-path="../Java/3-01.Java 容器.html">
            
                <a href="../Java/3-01.Java 容器.html">
            
                    
                    3-01.Java 容器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.18" data-path="../Java/3-02.设计模式.html">
            
                <a href="../Java/3-02.设计模式.html">
            
                    
                    3-02.设计模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Net
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../Net/3-01.底层网络协议.html">
            
                <a href="../Net/3-01.底层网络协议.html">
            
                    
                    3-01.底层网络协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../Net/3-02.OSI模型.html">
            
                <a href="../Net/3-02.OSI模型.html">
            
                    
                    3-02.OSI模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../Net/3-03.TCP UDP.html">
            
                <a href="../Net/3-03.TCP UDP.html">
            
                    
                    3-03.TCP UDP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../Net/3-04.HTTP.html">
            
                <a href="../Net/3-04.HTTP.html">
            
                    
                    3-04.HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../Net/3-05.HTTP描述一次网络请求的流程.html">
            
                <a href="../Net/3-05.HTTP描述一次网络请求的流程.html">
            
                    
                    3-05.HTTP描述一次网络请求的流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../Net/3-06.HTTPS.html">
            
                <a href="../Net/3-06.HTTPS.html">
            
                    
                    3-06.HTTPS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Performance
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="0.概论.html">
            
                <a href="0.概论.html">
            
                    
                    0.概论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="1.Android优化大全.html">
            
                <a href="1.Android优化大全.html">
            
                    
                    1.Android优化大全
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.3" data-path="10.ANR.html">
            
                <a href="10.ANR.html">
            
                    
                    10.ANR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="11.启动优化.html">
            
                <a href="11.启动优化.html">
            
                    
                    11.启动优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="12.布局优化.html">
            
                <a href="12.布局优化.html">
            
                    
                    12.布局优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="13.Bitmap优化.html">
            
                <a href="13.Bitmap优化.html">
            
                    
                    13.Bitmap优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="14.线程优化.html">
            
                <a href="14.线程优化.html">
            
                    
                    14.线程优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="15.Apk包大小优化.html">
            
                <a href="15.Apk包大小优化.html">
            
                    
                    15.Apk包大小优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="16.LruCache.html">
            
                <a href="16.LruCache.html">
            
                    
                    16.LruCache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="17.WebView缓存优化.html">
            
                <a href="17.WebView缓存优化.html">
            
                    
                    17.WebView缓存优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="18.电量优化.html">
            
                <a href="18.电量优化.html">
            
                    
                    18.电量优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="19.mmap + native 日志优化.html">
            
                <a href="19.mmap + native 日志优化.html">
            
                    
                    19.mmap + native 日志优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="2.优化参考资料.html">
            
                <a href="2.优化参考资料.html">
            
                    
                    2.优化参考资料
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="20.IO优化、mmkv原理.html">
            
                <a href="20.IO优化、mmkv原理.html">
            
                    
                    20.IO优化、mmkv原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="21.Bug分析.html">
            
                <a href="21.Bug分析.html">
            
                    
                    21.Bug分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="22.数据结构选择优化.html">
            
                <a href="22.数据结构选择优化.html">
            
                    
                    22.数据结构选择优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="23.OutOfMemoryError.html">
            
                <a href="23.OutOfMemoryError.html">
            
                    
                    23.OutOfMemoryError
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="24.Trace.html">
            
                <a href="24.Trace.html">
            
                    
                    24.Trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="25.MAT使用.html">
            
                <a href="25.MAT使用.html">
            
                    
                    25.MAT使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20" data-path="26.UI卡顿分析.html">
            
                <a href="26.UI卡顿分析.html">
            
                    
                    26.UI卡顿分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.21" data-path="27.网络优化.html">
            
                <a href="27.网络优化.html">
            
                    
                    27.网络优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.22" data-path="28.崩溃优化.html">
            
                <a href="28.崩溃优化.html">
            
                    
                    28.崩溃优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.23" data-path="3.内存模型管理及GC.html">
            
                <a href="3.内存模型管理及GC.html">
            
                    
                    3.内存模型管理及GC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.24" data-path="4.ART vs Dalvik.html">
            
                <a href="4.ART vs Dalvik.html">
            
                    
                    4.ART vs Dalvik
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.25" data-path="5.Android内存回收机制.html">
            
                <a href="5.Android内存回收机制.html">
            
                    
                    5.Android内存回收机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.26" data-path="6.Low Memory Killer 机制.html">
            
                <a href="6.Low Memory Killer 机制.html">
            
                    
                    6.Low Memory Killer 机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.27" data-path="7.内存优化工具.html">
            
                <a href="7.内存优化工具.html">
            
                    
                    7.内存优化工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.28" data-path="8.内存性能测试.html">
            
                <a href="8.内存性能测试.html">
            
                    
                    8.内存性能测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.29" data-path="9.内存问题及解决方案.html">
            
                <a href="9.内存问题及解决方案.html">
            
                    
                    9.内存问题及解决方案
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >10.ANR</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#anr"><b>1. </b>ANR</a></li><ul><li><span class="title-icon "></span><a href="#&#x4E00;&#x3001;-anr&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;"><b>1.1. </b>&#x4E00;&#x3001; ANR&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;</a></li><ul><li><span class="title-icon "></span><a href="#11-&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;"><b>1.1.1. </b>1.1 &#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;</a></li><li><span class="title-icon "></span><a href="#12-&#x8D85;&#x65F6;&#x68C0;&#x6D4B;"><b>1.1.2. </b>1.2 &#x8D85;&#x65F6;&#x68C0;&#x6D4B;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E8C;&#x3001;-broadcastreceiver&#x51FA;&#x73B0;anr"><b>1.2. </b>&#x4E8C;&#x3001; BroadcastReceiver&#x51FA;&#x73B0;ANR</a></li><ul><li><span class="title-icon "></span><a href="#21-&#x57CB;&#x70B8;&#x5F39;"><b>1.2.1. </b>2.1 &#x57CB;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#22-&#x62C6;&#x70B8;&#x5F39;"><b>1.2.2. </b>2.2 &#x62C6;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#23-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><b>1.2.3. </b>2.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E09;&#x3001;-service&#x51FA;&#x73B0;anr"><b>1.3. </b>&#x4E09;&#x3001; Service&#x51FA;&#x73B0;ANR</a></li><ul><li><span class="title-icon "></span><a href="#31-&#x57CB;&#x70B8;&#x5F39;"><b>1.3.1. </b>3.1 &#x57CB;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#32-&#x62C6;&#x70B8;&#x5F39;"><b>1.3.2. </b>3.2 &#x62C6;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#33-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><b>1.3.3. </b>3.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</a></li></ul><li><span class="title-icon "></span><a href="#&#x56DB;&#x3001;provider&#x51FA;&#x73B0;anr"><b>1.4. </b>&#x56DB;&#x3001;Provider&#x51FA;&#x73B0;ANR</a></li><ul><li><span class="title-icon "></span><a href="#41-&#x57CB;&#x70B8;&#x5F39;"><b>1.4.1. </b>4.1 &#x57CB;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#42-&#x62C6;&#x70B8;&#x5F39;"><b>1.4.2. </b>4.2 &#x62C6;&#x70B8;&#x5F39;</a></li><li><span class="title-icon "></span><a href="#43-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><b>1.4.3. </b>4.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E94;&#x3001;anr&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;"><b>1.5. </b>&#x4E94;&#x3001;ANR&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;</a></li><ul><li><span class="title-icon "></span><a href="#51-&#x4E3B;&#x7EBF;&#x7A0B;binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;"><b>1.5.1. </b>5.1 &#x4E3B;&#x7EBF;&#x7A0B;Binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;</a></li><li><span class="title-icon "></span><a href="#52-&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;"><b>1.5.2. </b>5.2 &#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;</a></li><li><span class="title-icon "></span><a href="#53-&#x5361;&#x5728;io&#x4E0A;"><b>1.5.3. </b>5.3 &#x5361;&#x5728;IO&#x4E0A;</a></li><li><span class="title-icon "></span><a href="#54-&#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;"><b>1.5.4. </b>5.4 &#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;</a></li><li><span class="title-icon "></span><a href="#55-binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;"><b>1.5.5. </b>5.5 binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;</a></li><li><span class="title-icon "></span><a href="#56-je&#x6216;&#x8005;ne&#x5BFC;&#x81F4;anr"><b>1.5.6. </b>5.6 JE&#x6216;&#x8005;NE&#x5BFC;&#x81F4;ANR</a></li><li><span class="title-icon "></span><a href="#57-&#x53EA;&#x5B58;&#x5728;&#x4E8E;monkey&#x6D4B;&#x8BD5;&#x4E0B;"><b>1.5.7. </b>5.7 &#x53EA;&#x5B58;&#x5728;&#x4E8E;Monkey&#x6D4B;&#x8BD5;&#x4E0B;</a></li></ul><li><span class="title-icon "></span><a href="#&#x516D;&#x3001;-tracetxt"><b>1.6. </b>&#x516D;&#x3001; Trace.txt</a></li><ul><li><span class="title-icon "></span><a href="#61-&#x5BFC;&#x51FA;tracestxt&#x6587;&#x4EF6;"><b>1.6.1. </b>6.1 &#x5BFC;&#x51FA;traces.txt&#x6587;&#x4EF6;</a></li><li><span class="title-icon "></span><a href="#62-tracestxt&#x6587;&#x4EF6;&#x5206;&#x6790;"><b>1.6.2. </b>6.2 traces.txt&#x6587;&#x4EF6;&#x5206;&#x6790;</a></li><li><span class="title-icon "></span><a href="#63-traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;"><b>1.6.3. </b>6.3 traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;</a></li></ul><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;"><b>1.7. </b>&#x53C2;&#x8003;</a></li></ul></ul></div><a href="#anr" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 align="center" id="anr"><a name="anr" class="anchor-navigation-ex-anchor" href="#anr"><i class="fa fa-link" aria-hidden="true"></i></a>1. ANR</h1>

<p>[toc]</p>
<h2 id="&#x4E00;&#x3001;-anr&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;"><a name="&#x4E00;&#x3001;-anr&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;" class="anchor-navigation-ex-anchor" href="#&#x4E00;&#x3001;-anr&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x4E00;&#x3001; ANR&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;&#x65F6;&#x95F4;</h2>
<h3 id="11-&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;"><a name="11-&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;" class="anchor-navigation-ex-anchor" href="#11-&#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1. 1.1 &#x5206;&#x7C7B;&#x53CA;&#x8D85;&#x65F6;</h3>
<ul>
<li><strong>InputDispatching Timeout&#xFF1A;</strong> 5&#x79D2;&#x5185;&#x65E0;&#x6CD5;&#x54CD;&#x5E94;&#x5C4F;&#x5E55;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x6216;&#x952E;&#x76D8;&#x8F93;&#x5165;&#x4E8B;&#x4EF6;</li>
<li><strong>BroadcastQueue Timeout &#xFF1A;</strong> &#x5728;&#x6267;&#x884C;&#x524D;&#x53F0;&#x5E7F;&#x64AD;&#xFF08;BroadcastReceiver&#xFF09;&#x7684;onReceive()&#x51FD;&#x6570;&#x65F6;10&#x79D2;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x5B8C;&#x6210;&#xFF0C;&#x540E;&#x53F0;&#x4E3A;60&#x79D2;&#x3002;</li>
<li><strong>Service Timeout &#xFF1A;</strong> &#x524D;&#x53F0;&#x670D;&#x52A1;20&#x79D2;&#x5185;&#xFF0C;&#x540E;&#x53F0;&#x670D;&#x52A1;&#x5728;200&#x79D2;&#x5185;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</li>
<li><strong>ContentProvider Timeout &#xFF1A;</strong> ContentProvider&#x7684;publish&#x5728;10s&#x5185;&#x6CA1;&#x8FDB;&#x884C;&#x5B8C;&#x3002;</li>
</ul>
<blockquote>
<p>&#x6240;&#x4EE5;&#x53EF;&#x80FD;&#x5F88;&#x591A;&#x5C0F;&#x4F19;&#x4F34;&#x4F1A;&#x628A;&#x4E0A;&#x9762;&#x56DB;&#x4E2A;&#x6761;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x548C; Activity &#x76F4;&#x63A5;&#x6302;&#x94A9;&#xFF0C;&#x4EE5;&#x4E3A;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8017;&#x65F6;&#x8D85;&#x8FC7; 5s &#x5C31;&#x4F1A; ANR&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x662F; <strong>InputDispatching&#x3002;</strong></p>
</blockquote>
<h3 id="12-&#x8D85;&#x65F6;&#x68C0;&#x6D4B;"><a name="12-&#x8D85;&#x65F6;&#x68C0;&#x6D4B;" class="anchor-navigation-ex-anchor" href="#12-&#x8D85;&#x65F6;&#x68C0;&#x6D4B;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.2. 1.2 &#x8D85;&#x65F6;&#x68C0;&#x6D4B;</h3>
<h4 id="121-service&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;"><a name="121-service&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#121-service&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.1 Service&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;</h4>
<ul>
<li>&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x76F8;&#x5E94;&#x64CD;&#x4F5C;&#x6765;&#x89E6;&#x53D1;&#x79FB;&#x9664;&#x5EF6;&#x65F6;&#x6D88;&#x606F;&#xFF0C;&#x5219;&#x4F1A;&#x89E6;&#x53D1;anr;</li>
</ul>
<h4 id="122-broadcastreceiver&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;"><a name="122-broadcastreceiver&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#122-broadcastreceiver&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.2 BroadcastReceiver&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#xFF1A;</h4>
<ul>
<li>&#x6709;&#x5E8F;&#x5E7F;&#x64AD;&#x7684;&#x603B;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x8D85;&#x8FC7; 2 <em> receiver&#x4E2A;&#x6570; </em> timeout&#x65F6;&#x957F;&#xFF0C;&#x5219;&#x4F1A;&#x89E6;&#x53D1;anr;</li>
<li>&#x6709;&#x5E8F;&#x5E7F;&#x64AD;&#x7684;&#x67D0;&#x4E00;&#x4E2A;receiver&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x8D85;&#x8FC7; timeout&#x65F6;&#x957F;&#xFF0C;&#x5219;&#x4F1A;&#x89E6;&#x53D1;anr;</li>
</ul>
<h4 id="123-&#x53E6;&#x5916;"><a name="123-&#x53E6;&#x5916;" class="anchor-navigation-ex-anchor" href="#123-&#x53E6;&#x5916;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.3 &#x53E6;&#x5916;:</h4>
<ul>
<li>&#x5BF9;&#x4E8E;Service&#xFF0C;Broadcast,&#xFF0C;Input&#x53D1;&#x751F;ANR&#x4E4B;&#x540E;,&#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x8C03;&#x7528;AMS.appNotResponding;</li>
<li>&#x5BF9;&#x4E8E;provider,&#x5728;&#x5176;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x65F6;publish&#x8FC7;&#x7A0B;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;ANR&#xFF0C;<strong>&#x5219;&#x4F1A;&#x76F4;&#x63A5;&#x6740;&#x8FDB;&#x7A0B;&#x4EE5;&#x53CA;&#x6E05;&#x7406;&#x76F8;&#x5E94;&#x4FE1;&#x606F;,&#x800C;&#x4E0D;&#x4F1A;&#x5F39;&#x51FA;ANR&#x7684;&#x5BF9;&#x8BDD;&#x6846;</strong>. appNotRespondingViaProvider()&#x8FC7;&#x7A0B;&#x4F1A;&#x8D70;<strong>appNotResponding()</strong>&#xFF0C; &#x8FD9;&#x4E2A;&#x5C31;&#x4E0D;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#xFF0C;&#x7531;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x8D85;&#x65F6;&#x65F6;&#x95F4;.</li>
</ul>
<h2 id="&#x4E8C;&#x3001;-broadcastreceiver&#x51FA;&#x73B0;anr"><a name="&#x4E8C;&#x3001;-broadcastreceiver&#x51FA;&#x73B0;anr" class="anchor-navigation-ex-anchor" href="#&#x4E8C;&#x3001;-broadcastreceiver&#x51FA;&#x73B0;anr"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x4E8C;&#x3001; BroadcastReceiver&#x51FA;&#x73B0;ANR</h2>
<p>BroadcastReceiver Timeout&#x662F;&#x4F4D;&#x4E8E;&#x201D;ActivityManager&#x201D;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;BroadcastQueue.BroadcastHandler&#x6536;&#x5230;BROADCAST_TIMEOUT_MSG&#x6D88;&#x606F;&#x65F6;&#x89E6;&#x53D1;&#x3002;</p>
<ul>
<li>&#x5BF9;&#x4E8E;&#x5E7F;&#x64AD;&#x961F;&#x5217;&#x6709;&#x4E24;&#x4E2A;: foreground&#x961F;&#x5217;&#x548C;background&#x961F;&#x5217;:<ul>
<li>&#x5BF9;&#x4E8E;&#x524D;&#x53F0;&#x5E7F;&#x64AD;&#xFF0C;&#x5219;&#x8D85;&#x65F6;&#x4E3A;BROADCAST_FG_TIMEOUT = 10s&#xFF1B;</li>
<li>&#x5BF9;&#x4E8E;&#x540E;&#x53F0;&#x5E7F;&#x64AD;&#xFF0C;&#x5219;&#x8D85;&#x65F6;&#x4E3A;BROADCAST_BG_TIMEOUT = 60s</li>
</ul>
</li>
</ul>
<h3 id="21-&#x57CB;&#x70B8;&#x5F39;"><a name="21-&#x57CB;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#21-&#x57CB;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.1. 2.1 &#x57CB;&#x70B8;&#x5F39;</h3>
<p><a href="https://www.jianshu.com/p/82aba8e60fad" target="_blank">Android&#x7EC4;&#x4EF6;3--Broadcast&#x5E7F;&#x64AD;&#x673A;&#x5236;&#x5206;&#x6790;</a>&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x5E7F;&#x64AD;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528; processNextBroadcast&#x6765;&#x5904;&#x7406;&#x5E7F;&#x64AD;.&#x5176;&#x6D41;&#x7A0B;&#x4E3A;&#x5148;&#x5904;&#x7406;&#x5E76;&#x884C;&#x5E7F;&#x64AD;,&#x518D;&#x5904;&#x7406;&#x5F53;&#x524D;&#x6709;&#x5E8F;&#x5E7F;&#x64AD;,&#x6700;&#x540E;&#x83B7;&#x53D6;&#x5E76;&#x5904;&#x7406;&#x4E0B;&#x6761;&#x6709;&#x5E8F;&#x5E7F;&#x64AD;.</p>
<h4 id="211-processnextbroadcast"><a name="211-processnextbroadcast" class="anchor-navigation-ex-anchor" href="#211-processnextbroadcast"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1 processNextBroadcast</h4>
<p>[-&gt; BroadcastQueue.java]</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processNextBroadcast</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> fromMsg)</span> </span>{
    <span class="hljs-keyword">synchronized</span>(mService) {
        ...
        <span class="hljs-comment">//part 2: &#x5904;&#x7406;&#x5F53;&#x524D;&#x6709;&#x5E8F;&#x5E7F;&#x64AD;</span>
        do {
            r = mOrderedBroadcasts.get(<span class="hljs-number">0</span>);
            <span class="hljs-comment">//&#x83B7;&#x53D6;&#x6240;&#x6709;&#x8BE5;&#x5E7F;&#x64AD;&#x6240;&#x6709;&#x7684;&#x63A5;&#x6536;&#x8005;</span>
            <span class="hljs-keyword">int</span> numReceivers = (r.receivers != <span class="hljs-keyword">null</span>) ? r.receivers.size() : <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (mService.mProcessesReady &amp;&amp; r.dispatchTime &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">long</span> now = SystemClock.uptimeMillis();
                <span class="hljs-keyword">if</span> ((numReceivers &gt; <span class="hljs-number">0</span>) &amp;&amp;
                        (now &gt; r.dispatchTime + (<span class="hljs-number">2</span>*mTimeoutPeriod*numReceivers))) {
                    <span class="hljs-comment">//&#x5F53;&#x5E7F;&#x64AD;&#x5904;&#x7406;&#x65F6;&#x95F4;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x5F3A;&#x5236;&#x7ED3;&#x675F;&#x8FD9;&#x6761;&#x5E7F;&#x64AD;&#x3010;&#x89C1;&#x5C0F;&#x8282;3.3.2&#x3011;</span>
                    broadcastTimeoutLocked(<span class="hljs-keyword">false</span>);
                    ...
                }
            }
            <span class="hljs-keyword">if</span> (r.receivers == <span class="hljs-keyword">null</span> || r.nextReceiver &gt;= numReceivers
                    || r.resultAbort || forceReceive) {
                <span class="hljs-keyword">if</span> (r.resultTo != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-comment">//&#x5904;&#x7406;&#x5E7F;&#x64AD;&#x6D88;&#x606F;&#x6D88;&#x606F;</span>
                    performReceiveLocked(r.callerApp, r.resultTo,
                        <span class="hljs-keyword">new</span> Intent(r.intent), r.resultCode,
                        r.resultData, r.resultExtras, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, r.userId);
                    r.resultTo = <span class="hljs-keyword">null</span>;
                }
                <span class="hljs-comment">//&#x62C6;&#x70B8;&#x5F39;&#x3010;&#x89C1;&#x5C0F;&#x8282;3.2.1&#x3011;</span>
                cancelBroadcastTimeoutLocked();
            }
        } <span class="hljs-keyword">while</span> (r == <span class="hljs-keyword">null</span>);
        ...

        <span class="hljs-comment">//part 3: &#x83B7;&#x53D6;&#x4E0B;&#x6761;&#x6709;&#x5E8F;&#x5E7F;&#x64AD;</span>
        r.receiverTime = SystemClock.uptimeMillis();
        <span class="hljs-keyword">if</span> (!mPendingBroadcastTimeoutMessage) {
            <span class="hljs-keyword">long</span> timeoutTime = r.receiverTime + mTimeoutPeriod;
            <span class="hljs-comment">//&#x57CB;&#x70B8;&#x5F39;&#x3010;&#x89C1;&#x5C0F;&#x8282;3.1.3&#x3011;</span>
            setBroadcastTimeoutLocked(timeoutTime);
        }
        ...
    }
}
</code></pre>
<p>&#x5BF9;&#x4E8E;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;&#x5904;&#x7406;&#x65F6;&#x673A;&#xFF1A;</p>
<ol>
<li>&#x9996;&#x5148;&#x5728;part3&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;setBroadcastTimeoutLocked(timeoutTime) &#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x5E7F;&#x64AD;&#x6D88;&#x606F;&#xFF1B;</li>
<li>&#x7136;&#x540E;&#x5728;part2&#x6839;&#x636E;&#x5E7F;&#x64AD;&#x5904;&#x7406;&#x60C5;&#x51B5;&#x6765;&#x5904;&#x7406;&#xFF1A;<ul>
<li>&#x5F53;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x8005;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#xFF0C;&#x5219;&#x8C03;&#x7528;broadcastTimeoutLocked(false);</li>
<li>&#x5F53;&#x6267;&#x884C;&#x5B8C;&#x5E7F;&#x64AD;,&#x5219;&#x8C03;&#x7528;cancelBroadcastTimeoutLocked;</li>
</ul>
</li>
</ol>
<h4 id="212-setbroadcasttimeoutlocked"><a name="212-setbroadcasttimeoutlocked" class="anchor-navigation-ex-anchor" href="#212-setbroadcasttimeoutlocked"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2 setBroadcastTimeoutLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBroadcastTimeoutLocked</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeoutTime)</span> </span>{
    <span class="hljs-keyword">if</span> (! mPendingBroadcastTimeoutMessage) {
        Message msg = mHandler.obtainMessage(BROADCAST_TIMEOUT_MSG, <span class="hljs-keyword">this</span>);
        mHandler.sendMessageAtTime(msg, timeoutTime);
        mPendingBroadcastTimeoutMessage = <span class="hljs-keyword">true</span>;
    }
}
</code></pre>
<p>&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5E7F;&#x64AD;BROADCAST_TIMEOUT_MSG&#xFF0C;&#x5373;&#x5F53;&#x524D;&#x5F80;&#x540E;&#x63A8;mTimeoutPeriod&#x65F6;&#x95F4;&#x5E7F;&#x64AD;&#x8FD8;&#x6CA1;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#xFF0C;&#x5219;&#x8FDB;&#x5165;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;&#x6D41;&#x7A0B;&#x3002;</p>
<h3 id="22-&#x62C6;&#x70B8;&#x5F39;"><a name="22-&#x62C6;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#22-&#x62C6;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.2. 2.2 &#x62C6;&#x70B8;&#x5F39;</h3>
<p>&#x5728;processNextBroadcast()&#x8FC7;&#x7A0B;, &#x6267;&#x884C;&#x5B8C;performReceiveLocked,&#x4FBF;&#x4F1A;&#x62C6;&#x9664;&#x70B8;&#x5F39;.</p>
<h4 id="221-cancelbroadcasttimeoutlocked"><a name="221-cancelbroadcasttimeoutlocked" class="anchor-navigation-ex-anchor" href="#221-cancelbroadcasttimeoutlocked"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1 cancelBroadcastTimeoutLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cancelBroadcastTimeoutLocked</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (mPendingBroadcastTimeoutMessage) {
        mHandler.removeMessages(BROADCAST_TIMEOUT_MSG, <span class="hljs-keyword">this</span>);
        mPendingBroadcastTimeoutMessage = <span class="hljs-keyword">false</span>;
    }
}
</code></pre>
<p>&#x79FB;&#x9664;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;&#x6D88;&#x606F;BROADCAST_TIMEOUT_MSG</p>
<h3 id="23-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><a name="23-&#x5F15;&#x7206;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#23-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.3. 2.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</h3>
<h4 id="231-broadcasthandlerhandlemessage"><a name="231-broadcasthandlerhandlemessage" class="anchor-navigation-ex-anchor" href="#231-broadcasthandlerhandlemessage"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1 BroadcastHandler.handleMessage</h4>
<p>[-&gt; BroadcastQueue.java ::BroadcastHandler]</p>
<pre><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BroadcastHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
        <span class="hljs-keyword">switch</span> (msg.what) {
            <span class="hljs-keyword">case</span> BROADCAST_TIMEOUT_MSG: {
                <span class="hljs-keyword">synchronized</span> (mService) {
                    <span class="hljs-comment">//&#x3010;&#x89C1;&#x5C0F;&#x8282;3.3.2&#x3011;</span>
                    broadcastTimeoutLocked(<span class="hljs-keyword">true</span>);
                }
            } <span class="hljs-keyword">break</span>;
            ...
        }
        ...
    }
}
</code></pre>
<h4 id="232-broadcasttimeoutlocked"><a name="232-broadcasttimeoutlocked" class="anchor-navigation-ex-anchor" href="#232-broadcasttimeoutlocked"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2 broadcastTimeoutLocked</h4>
<p>[-&gt; BroadcastRecord.java]</p>
<pre><code class="lang-kotlin"><span class="hljs-comment">//fromMsg = true</span>
<span class="hljs-keyword">final</span> void broadcastTimeoutLocked(boolean fromMsg) {
    <span class="hljs-keyword">if</span> (fromMsg) {
        mPendingBroadcastTimeoutMessage = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (mOrderedBroadcasts.size() == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>;
    }

    long now = SystemClock.uptimeMillis();
    BroadcastRecord r = mOrderedBroadcasts.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (fromMsg) {
        <span class="hljs-keyword">if</span> (mService.mDidDexOpt) {
            mService.mDidDexOpt = <span class="hljs-literal">false</span>;
            long timeoutTime = SystemClock.uptimeMillis() + mTimeoutPeriod;
            setBroadcastTimeoutLocked(timeoutTime);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (!mService.mProcessesReady) {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">//&#x5F53;&#x7CFB;&#x7EDF;&#x8FD8;&#x6CA1;&#x6709;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#x65F6;&#xFF0C;&#x5E7F;&#x64AD;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x4E2D;&#x4E0D;&#x5B58;&#x5728;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;</span>
        }

        long timeoutTime = r.receiverTime + mTimeoutPeriod;
        <span class="hljs-keyword">if</span> (timeoutTime &gt; now) {
            <span class="hljs-comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;receiver&#x6CA1;&#x6709;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;</span>
            setBroadcastTimeoutLocked(timeoutTime);
            <span class="hljs-keyword">return</span>;
        }
    }

    BroadcastRecord br = mOrderedBroadcasts.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (br.state == BroadcastRecord.WAITING_SERVICES) {
        <span class="hljs-comment">//&#x5E7F;&#x64AD;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x5B8C;&#x6210;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x5DF2;&#x542F;&#x52A8;service&#x6267;&#x884C;&#x5B8C;&#x6210;&#x3002;&#x5F53;&#x7B49;&#x5F85;&#x8DB3;&#x591F;&#x65F6;&#x95F4;&#xFF0C;&#x5219;&#x5904;&#x7406;&#x4E0B;&#x4E00;&#x6761;&#x5E7F;&#x64AD;&#x3002;</span>
        br.curComponent = <span class="hljs-literal">null</span>;
        br.state = BroadcastRecord.IDLE;
        processNextBroadcast(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span>;
    }

    r.receiverTime = now;
    <span class="hljs-comment">//&#x5F53;&#x524D;BroadcastRecord&#x7684;anr&#x6B21;&#x6570;&#x6267;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;</span>
    r.anrCount++;

    <span class="hljs-keyword">if</span> (r.nextReceiver <span class="hljs-type">&lt;= 0) {
        return;
    }
    ...

    Object curReceiver = r.receivers.get(r.nextReceiver-1);
    //&#x67E5;&#x8BE2;App&#x8FDB;&#x7A0B;
    if (curReceiver instanceof BroadcastFilter) {
        BroadcastFilter bf = (BroadcastFilter)curReceiver;
        if (bf.receiverList.pid != 0
                &amp;&amp; bf.receiverList.pid != ActivityManagerService.MY_PID) {
            synchronized (mService.mPidsSelfLocked) {
                app = mService.mPidsSelfLocked.get(
                        bf.receiverList.pid);
            }
        }
    } else {
        app = r.curApp;
    }

    if (app != null) {
        anrMessage = &quot;Broadcast of &quot; + r.intent.toString();
    }

    if (mPendingBroadcast == r) {
        mPendingBroadcast = null;
    }

    //&#x7EE7;&#x7EED;&#x79FB;&#x52A8;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x5E7F;&#x64AD;&#x63A5;&#x6536;&#x8005;
    finishReceiverLocked(r, r.resultCode, r.resultData,
            r.resultExtras, r.resultAbort, false);
    scheduleBroadcastsLocked();

    if (anrMessage != null) {
        // [&#x89C1;&#x5C0F;&#x8282;3.3.3]
        mHandler.post(new AppNotResponding(app, anrMessage));
    }
}
</span></code></pre>
<ol>
<li>mOrderedBroadcasts&#x5DF2;&#x5904;&#x7406;&#x5B8C;&#x6210;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;anr;</li>
<li>&#x6B63;&#x5728;&#x6267;&#x884C;dexopt&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;anr;</li>
<li>&#x7CFB;&#x7EDF;&#x8FD8;&#x6CA1;&#x6709;&#x8FDB;&#x5165;ready&#x72B6;&#x6001;(mProcessesReady=false)&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;anr;</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;receiver&#x6CA1;&#x6709;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x5E7F;&#x64AD;&#x8D85;&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;anr;</li>
</ol>
<h4 id="233-appnotresponding"><a name="233-appnotresponding" class="anchor-navigation-ex-anchor" href="#233-appnotresponding"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3 AppNotResponding</h4>
<p>[-&gt; BroadcastQueue.java]</p>
<pre><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppNotResponding</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>{
    ...
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// &#x8FDB;&#x5165;ANR&#x5904;&#x7406;&#x6D41;&#x7A0B;</span>
        mService.appNotResponding(mApp, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>, mAnnotation);
    }
}
</code></pre>
<h2 id="&#x4E09;&#x3001;-service&#x51FA;&#x73B0;anr"><a name="&#x4E09;&#x3001;-service&#x51FA;&#x73B0;anr" class="anchor-navigation-ex-anchor" href="#&#x4E09;&#x3001;-service&#x51FA;&#x73B0;anr"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. &#x4E09;&#x3001; Service&#x51FA;&#x73B0;ANR</h2>
<p>&#x8FD9;&#x4E2A;&#x901A;&#x5E38;&#x5F88;&#x5C11;&#x51FA;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5728;Service&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6709;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#x540C;&#x6837;&#x4F1A;&#x51FA;&#x73B0;ANR&#x73B0;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Thread&#x6216;&#x8005;AsyncTask&#x6765;&#x5904;&#x7406;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
<p>Service Timeout&#x662F;&#x4F4D;&#x4E8E;&#x201D;ActivityManager&#x201D;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;<strong>AMS.MainHandler&#x6536;&#x5230;SERVICE_TIMEOUT_MSG&#x6D88;&#x606F;&#x65F6;&#x89E6;&#x53D1;</strong>&#x3002;</p>
<p>&#x5BF9;&#x4E8E;Service&#x6709;&#x4E24;&#x7C7B;:</p>
<ul>
<li>&#x5BF9;&#x4E8E;&#x524D;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x8D85;&#x65F6;&#x4E3A;SERVICE_TIMEOUT = 20s&#xFF1B;</li>
<li>&#x5BF9;&#x4E8E;&#x540E;&#x53F0;&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x8D85;&#x65F6;&#x4E3A;SERVICE_BACKGROUND_TIMEOUT = 200s</li>
</ul>
<p>&#x7531;&#x53D8;&#x91CF;ProcessRecord.execServicesFg&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x524D;&#x53F0;&#x542F;&#x52A8;</p>
<h3 id="31-&#x57CB;&#x70B8;&#x5F39;"><a name="31-&#x57CB;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#31-&#x57CB;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.1. 3.1 &#x57CB;&#x70B8;&#x5F39;</h3>
<p><a href="https://www.jianshu.com/p/3245c8f5025f" target="_blank">Android&#x7EC4;&#x4EF6;1--startService&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x5206;&#x6790;</a>&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;Service&#x542F;&#x52A8;&#x6D41;&#x7A0B;. &#x5176;&#x4E2D;&#x5728;Service&#x8FDB;&#x7A0B;attach&#x5230;system_server&#x8FDB;&#x7A0B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;realStartServiceLocked()&#x65B9;&#x6CD5;&#x6765;&#x57CB;&#x4E0B;&#x70B8;&#x5F39;.</p>
<h4 id="311-asrealstartservicelocked"><a name="311-asrealstartservicelocked" class="anchor-navigation-ex-anchor" href="#311-asrealstartservicelocked"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.1 AS.realStartServiceLocked</h4>
<p>[-&gt; ActiveServices.java]</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">realStartServiceLocked</span><span class="hljs-params">(ServiceRecord r, ProcessRecord app, <span class="hljs-keyword">boolean</span> execInFg)</span> <span class="hljs-keyword">throws</span> RemoteException </span>{
    ...
    <span class="hljs-comment">//&#x53D1;&#x9001;delay&#x6D88;&#x606F;(SERVICE_TIMEOUT_MSG)&#xFF0C;&#x3010;&#x89C1;&#x5C0F;&#x8282;2.1.2&#x3011;</span>
    bumpServiceExecutingLocked(r, execInFg, <span class="hljs-string">&quot;create&quot;</span>);
    <span class="hljs-keyword">try</span> {
        ...
        <span class="hljs-comment">//&#x6700;&#x7EC8;&#x6267;&#x884C;&#x670D;&#x52A1;&#x7684;onCreate()&#x65B9;&#x6CD5;</span>
        app.thread.scheduleCreateService(r, r.serviceInfo,
                mAm.compatibilityInfoForPackageLocked(r.serviceInfo.applicationInfo),
                app.repProcState);
    } <span class="hljs-keyword">catch</span> (DeadObjectException e) {
        mAm.appDiedLocked(app);
        <span class="hljs-keyword">throw</span> e;
    } <span class="hljs-keyword">finally</span> {
        ...
    }
}
</code></pre>
<h4 id="312-asbumpserviceexecutinglocked"><a name="312-asbumpserviceexecutinglocked" class="anchor-navigation-ex-anchor" href="#312-asbumpserviceexecutinglocked"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.2 AS.bumpServiceExecutingLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bumpServiceExecutingLocked</span><span class="hljs-params">(ServiceRecord r, <span class="hljs-keyword">boolean</span> fg, String why)</span> </span>{
    ... 
    scheduleServiceTimeoutLocked(r.app);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">scheduleServiceTimeoutLocked</span><span class="hljs-params">(ProcessRecord proc)</span> </span>{
    <span class="hljs-keyword">if</span> (proc.executingServices.size() == <span class="hljs-number">0</span> || proc.thread == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">long</span> now = SystemClock.uptimeMillis();
    Message msg = mAm.mHandler.obtainMessage(
            ActivityManagerService.SERVICE_TIMEOUT_MSG);
    msg.obj = proc;

    <span class="hljs-comment">//&#x5F53;&#x8D85;&#x65F6;&#x540E;&#x4ECD;&#x6CA1;&#x6709;remove&#x8BE5;SERVICE_TIMEOUT_MSG&#x6D88;&#x606F;&#xFF0C;&#x5219;&#x6267;&#x884C;service Timeout&#x6D41;&#x7A0B;&#x3010;&#x89C1;2.3.1&#x3011;</span>
    mAm.mHandler.sendMessageAtTime(msg,
        proc.execServicesFg ? (now+SERVICE_TIMEOUT) : (now+ SERVICE_BACKGROUND_TIMEOUT));
}
</code></pre>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x5DE5;&#x4F5C;&#x53D1;&#x9001;delay&#x6D88;&#x606F;(SERVICE_TIMEOUT_MSG). &#x70B8;&#x5F39;&#x5DF2;&#x57CB;&#x4E0B;, &#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5E0C;&#x671B;&#x70B8;&#x5F39;&#x88AB;&#x5F15;&#x7206;, &#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5728;&#x70B8;&#x5F39;&#x7206;&#x70B8;&#x4E4B;&#x524D;&#x62C6;&#x9664;&#x70B8;&#x5F39;.</p>
<h3 id="32-&#x62C6;&#x70B8;&#x5F39;"><a name="32-&#x62C6;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#32-&#x62C6;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.2. 3.2 &#x62C6;&#x70B8;&#x5F39;</h3>
<ul>
<li>&#x5728;system_server&#x8FDB;&#x7A0B;AS.realStartServiceLocked()&#x8C03;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4F1A;&#x57CB;&#x4E0B;&#x4E00;&#x9897;&#x70B8;&#x5F39;, &#x8D85;&#x65F6;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x5219;&#x4F1A;&#x7206;&#x70B8;.</li>
<li>&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F1A;&#x62C6;&#x9664;&#x8FD9;&#x9897;&#x70B8;&#x5F39;&#x7684;&#x5F15;&#x7EBF;&#x5462;? &#x7ECF;&#x8FC7;Binder&#x7B49;&#x5C42;&#x5C42;&#x8C03;&#x7528;&#x8FDB;&#x5165;&#x76EE;&#x6807;&#x8FDB;&#x7A0B;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;handleCreateService()&#x7684;&#x8FC7;&#x7A0B;.</li>
</ul>
<h4 id="321-athandlecreateservice"><a name="321-athandlecreateservice" class="anchor-navigation-ex-anchor" href="#321-athandlecreateservice"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.1 AT.handleCreateService</h4>
<p>[-&gt; ActivityThread.java]</p>
<pre><code class="lang-kotlin">    <span class="hljs-keyword">private</span> void handleCreateService(CreateServiceData data) {
        ...
        java.lang.ClassLoader cl = packageInfo.getClassLoader();
        Service service = (Service) cl.loadClass(data.info.name).newInstance();
        ...

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//&#x521B;&#x5EFA;ContextImpl&#x5BF9;&#x8C61;</span>
            ContextImpl context = ContextImpl.createAppContext(this, packageInfo);
            context.setOuterContext(service);
            <span class="hljs-comment">//&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;</span>
            Application app = packageInfo.makeApplication(<span class="hljs-literal">false</span>, mInstrumentation);
            service.attach(context, this, data.info.name, data.token, app,
                    ActivityManagerNative.getDefault());
            <span class="hljs-comment">//&#x8C03;&#x7528;&#x670D;&#x52A1;onCreate()&#x65B9;&#x6CD5; </span>
            service.onCreate();

            <span class="hljs-comment">//&#x62C6;&#x9664;&#x70B8;&#x5F39;&#x5F15;&#x7EBF;[&#x89C1;&#x5C0F;&#x8282;2.2.2]</span>
            ActivityManagerNative.getDefault().serviceDoneExecuting(
                    data.token, SERVICE_DONE_EXECUTING_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            ...
        }
    }
</code></pre>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4F1A;&#x521B;&#x5EFA;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x5BF9;&#x8C61;,&#x4EE5;&#x53CA;&#x56DE;&#x8C03;onCreate()&#x65B9;&#x6CD5;, &#x7D27;&#x63A5;&#x518D;&#x6B21;&#x7ECF;&#x8FC7;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x56DE;&#x5230;system_server&#x6765;&#x6267;&#x884C;serviceDoneExecuting.</p>
<h4 id="322-asservicedoneexecutinglocked"><a name="322-asservicedoneexecutinglocked" class="anchor-navigation-ex-anchor" href="#322-asservicedoneexecutinglocked"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.2 AS.serviceDoneExecutingLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">serviceDoneExecutingLocked</span><span class="hljs-params">(ServiceRecord r, <span class="hljs-keyword">boolean</span> inDestroying, <span class="hljs-keyword">boolean</span> finishing)</span> </span>{
    ...
    <span class="hljs-keyword">if</span> (r.executeNesting &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (r.app != <span class="hljs-keyword">null</span>) {
            r.app.execServicesFg = <span class="hljs-keyword">false</span>;
            r.app.executingServices.remove(r);
            <span class="hljs-keyword">if</span> (r.app.executingServices.size() == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">//&#x5F53;&#x524D;&#x670D;&#x52A1;&#x6240;&#x5728;&#x8FDB;&#x7A0B;&#x4E2D;&#x6CA1;&#x6709;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;service</span>
                mAm.mHandler.removeMessages(ActivityManagerService.SERVICE_TIMEOUT_MSG, r.app);
        ...
    }
    ...
}
</code></pre>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x5DE5;&#x4F5C;&#x662F;&#x5F53;service&#x542F;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x5219;&#x79FB;&#x9664;&#x670D;&#x52A1;&#x8D85;&#x65F6;&#x6D88;&#x606F;SERVICE_TIMEOUT_MSG&#x3002;</p>
<h3 id="33-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><a name="33-&#x5F15;&#x7206;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#33-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.3. 3.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</h3>
<ul>
<li>&#x524D;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;&#x57CB;&#x70B8;&#x5F39;&#x548C;&#x62C6;&#x70B8;&#x5F39;&#x7684;&#x8FC7;&#x7A0B;, &#x5982;&#x679C;&#x5728;&#x70B8;&#x5F39;&#x5012;&#x8BA1;&#x65F6;&#x7ED3;&#x675F;&#x4E4B;&#x524D;&#x6210;&#x529F;&#x62C6;&#x5378;&#x70B8;&#x5F39;,&#x90A3;&#x4E48;&#x5C31;&#x6CA1;&#x6709;&#x7206;&#x70B8;&#x7684;&#x673A;&#x4F1A;,</li>
<li>&#x4F46;&#x662F;&#x4E16;&#x4E8B;&#x96BE;&#x6599;. &#x603B;&#x6709;&#x4E9B;&#x6781;&#x7AEF;&#x60C5;&#x51B5;&#x4E0B;&#x65E0;&#x6CD5;&#x5373;&#x65F6;&#x62C6;&#x9664;&#x70B8;&#x5F39;,&#x5BFC;&#x81F4;&#x70B8;&#x5F39;&#x7206;&#x70B8;, &#x5176;&#x7ED3;&#x679C;&#x5C31;&#x662F;App&#x53D1;&#x751F;ANR. &#x63A5;&#x4E0B;&#x6765;,&#x5E26;&#x5927;&#x5BB6;&#x6765;&#x770B;&#x770B;&#x70B8;&#x5F39;&#x7206;&#x70B8;&#x7684;&#x73B0;&#x573A;:</li>
<li>&#x5728;system_server&#x8FDB;&#x7A0B;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;Handler&#x7EBF;&#x7A0B;, &#x540D;&#x53EB;&#x201D;ActivityManager&#x201D;.&#x5F53;&#x5012;&#x8BA1;&#x65F6;&#x7ED3;&#x675F;&#x4FBF;&#x4F1A;&#x5411;&#x8BE5;Handler&#x7EBF;&#x7A0B;&#x53D1;&#x9001; &#x4E00;&#x6761;&#x4FE1;&#x606F;SERVICE_TIMEOUT_MSG,</li>
</ul>
<h4 id="331-mainhandlerhandlemessage"><a name="331-mainhandlerhandlemessage" class="anchor-navigation-ex-anchor" href="#331-mainhandlerhandlemessage"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.1 MainHandler.handleMessage</h4>
<p>[-&gt; ActivityManagerService.java ::MainHandler]</p>
<pre><code class="lang-java"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
        <span class="hljs-keyword">switch</span> (msg.what) {
            <span class="hljs-keyword">case</span> SERVICE_TIMEOUT_MSG: {
                ...
                <span class="hljs-comment">//&#x3010;&#x89C1;&#x5C0F;&#x8282;2.3.2&#x3011;</span>
                mServices.serviceTimeout((ProcessRecord)msg.obj);
            } <span class="hljs-keyword">break</span>;
            ...
        }
        ...
    }
}
</code></pre>
<h4 id="332-asservicetimeout"><a name="332-asservicetimeout" class="anchor-navigation-ex-anchor" href="#332-asservicetimeout"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.2 AS.serviceTimeout</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serviceTimeout</span><span class="hljs-params">(ProcessRecord proc)</span> </span>{
    String anrMessage = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">synchronized</span>(mAm) {
        <span class="hljs-keyword">if</span> (proc.executingServices.size() == <span class="hljs-number">0</span> || proc.thread == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> now = SystemClock.uptimeMillis();
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> maxTime =  now -
                (proc.execServicesFg ? SERVICE_TIMEOUT : SERVICE_BACKGROUND_TIMEOUT);
        ServiceRecord timeout = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">long</span> nextTime = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=proc.executingServices.size()-<span class="hljs-number">1</span>; i&gt;=<span class="hljs-number">0</span>; i--) {
            ServiceRecord sr = proc.executingServices.valueAt(i);
            <span class="hljs-keyword">if</span> (sr.executingStart &lt; maxTime) {
                timeout = sr;
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">if</span> (sr.executingStart &gt; nextTime) {
                nextTime = sr.executingStart;
            }
        }
        <span class="hljs-keyword">if</span> (timeout != <span class="hljs-keyword">null</span> &amp;&amp; mAm.mLruProcesses.contains(proc)) {
            Slog.w(TAG, <span class="hljs-string">&quot;Timeout executing service: &quot;</span> + timeout);
            StringWriter sw = <span class="hljs-keyword">new</span> StringWriter();
            PrintWriter pw = <span class="hljs-keyword">new</span> FastPrintWriter(sw, <span class="hljs-keyword">false</span>, <span class="hljs-number">1024</span>);
            pw.println(timeout);
            timeout.dump(pw, <span class="hljs-string">&quot; &quot;</span>);
            pw.close();
            mLastAnrDump = sw.toString();
            mAm.mHandler.removeCallbacks(mLastAnrDumpClearer);
            mAm.mHandler.postDelayed(mLastAnrDumpClearer, LAST_ANR_LIFETIME_DURATION_MSECS);
            anrMessage = <span class="hljs-string">&quot;executing service &quot;</span> + timeout.shortName;
        }
    }

    <span class="hljs-keyword">if</span> (anrMessage != <span class="hljs-keyword">null</span>) {
        <span class="hljs-comment">//&#x5F53;&#x5B58;&#x5728;timeout&#x7684;service&#xFF0C;&#x5219;&#x6267;&#x884C;appNotResponding</span>
        mAm.appNotResponding(proc, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>, anrMessage);
    }
}
</code></pre>
<p>&#x5176;&#x4E2D;anrMessage&#x7684;&#x5185;&#x5BB9;&#x4E3A;&#x201D;executing service [&#x53D1;&#x9001;&#x8D85;&#x65F6;serviceRecord&#x4FE1;&#x606F;]&#x201D;;</p>
<h2 id="&#x56DB;&#x3001;provider&#x51FA;&#x73B0;anr"><a name="&#x56DB;&#x3001;provider&#x51FA;&#x73B0;anr" class="anchor-navigation-ex-anchor" href="#&#x56DB;&#x3001;provider&#x51FA;&#x73B0;anr"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. &#x56DB;&#x3001;Provider&#x51FA;&#x73B0;ANR</h2>
<ul>
<li>ContentProvider Timeout&#x662F;&#x4F4D;&#x4E8E;&#x201D;ActivityManager&#x201D;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;AMS.MainHandler&#x6536;&#x5230;CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG&#x6D88;&#x606F;&#x65F6;&#x89E6;&#x53D1;&#x3002;</li>
<li>ContentProvider &#x8D85;&#x65F6;&#x4E3A;CONTENT_PROVIDER_PUBLISH_TIMEOUT = 10s. &#x8FD9;&#x4E2A;&#x8DDF;&#x524D;&#x9762;&#x7684;Service&#x548C;BroadcastQueue&#x5B8C;&#x5168;&#x4E0D;&#x540C;, &#x7531;Provider<a href="http://gityuan.com/2016/10/09/app-process-create-2/" target="_blank">&#x8FDB;&#x7A0B;&#x542F;&#x52A8;</a>&#x8FC7;&#x7A0B;&#x76F8;&#x5173;.</li>
</ul>
<h3 id="41-&#x57CB;&#x70B8;&#x5F39;"><a name="41-&#x57CB;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#41-&#x57CB;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.1. 4.1 &#x57CB;&#x70B8;&#x5F39;</h3>
<p><a href="https://www.jianshu.com/p/4eaaad2461b4" target="_blank">Android&#x7EC4;&#x4EF6;4--&#x7406;&#x89E3;ContentProvider&#x539F;&#x7406;</a>&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;Provider&#x542F;&#x52A8;&#x6D41;&#x7A0B;. &#x57CB;&#x70B8;&#x5F39;&#x7684;&#x8FC7;&#x7A0B; &#x5176;&#x5B9E;&#x662F;&#x5728;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;,&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x540E;&#x4F1A;&#x8C03;&#x7528;attachApplicationLocked()&#x8FDB;&#x5165;system_server&#x8FDB;&#x7A0B;.</p>
<h4 id="411-amsattachapplicationlocked"><a name="411-amsattachapplicationlocked" class="anchor-navigation-ex-anchor" href="#411-amsattachapplicationlocked"><i class="fa fa-link" aria-hidden="true"></i></a>4.1.1 AMS.attachApplicationLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">attachApplicationLocked</span><span class="hljs-params">(IApplicationThread thread, <span class="hljs-keyword">int</span> pid)</span> </span>{
    ProcessRecord app;
    <span class="hljs-keyword">if</span> (pid != MY_PID &amp;&amp; pid &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">synchronized</span> (mPidsSelfLocked) {
            app = mPidsSelfLocked.get(pid); <span class="hljs-comment">// &#x6839;&#x636E;pid&#x83B7;&#x53D6;ProcessRecord</span>
        }
    } 
    ...

    <span class="hljs-comment">//&#x7CFB;&#x7EDF;&#x5904;&#x4E8E;ready&#x72B6;&#x6001;&#x6216;&#x8005;&#x8BE5;app&#x4E3A;FLAG_PERSISTENT&#x8FDB;&#x7A0B;&#x5219;&#x4E3A;true</span>
    <span class="hljs-keyword">boolean</span> normalMode = mProcessesReady || isAllowedWhileBooting(app.info);
    List&lt;ProviderInfo&gt; providers = normalMode ? generateApplicationProvidersLocked(app) : <span class="hljs-keyword">null</span>;

    <span class="hljs-comment">//app&#x8FDB;&#x7A0B;&#x5B58;&#x5728;&#x6B63;&#x5728;&#x542F;&#x52A8;&#x4E2D;&#x7684;provider,&#x5219;&#x8D85;&#x65F6;10s&#x540E;&#x53D1;&#x9001;CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG&#x6D88;&#x606F;</span>
    <span class="hljs-keyword">if</span> (providers != <span class="hljs-keyword">null</span> &amp;&amp; checkAppInLaunchingProvidersLocked(app)) {
        Message msg = mHandler.obtainMessage(CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG);
        msg.obj = app;
        mHandler.sendMessageDelayed(msg, CONTENT_PROVIDER_PUBLISH_TIMEOUT);
    }

    thread.bindApplication(...);
    ...
}
</code></pre>
<p>10s&#x4E4B;&#x540E;&#x5F15;&#x7206;&#x8BE5;&#x70B8;&#x5F39;</p>
<h3 id="42-&#x62C6;&#x70B8;&#x5F39;"><a name="42-&#x62C6;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#42-&#x62C6;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.2. 4.2 &#x62C6;&#x70B8;&#x5F39;</h3>
<p>&#x5F53;provider&#x6210;&#x529F;publish&#x4E4B;&#x540E;,&#x4FBF;&#x4F1A;&#x62C6;&#x9664;&#x8BE5;&#x70B8;&#x5F39;.</p>
<h4 id="421-amspublishcontentproviders"><a name="421-amspublishcontentproviders" class="anchor-navigation-ex-anchor" href="#421-amspublishcontentproviders"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1 AMS.publishContentProviders</h4>
<pre><code class="lang-dart">public <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> publishContentProviders(IApplicationThread caller, <span class="hljs-built_in">List</span>&lt;ContentProviderHolder&gt; providers) {
   ...

   synchronized (<span class="hljs-keyword">this</span>) {
       <span class="hljs-keyword">final</span> ProcessRecord r = getRecordForAppLocked(caller);

       <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> N = providers.size();
       <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++) {
           ContentProviderHolder src = providers.<span class="hljs-keyword">get</span>(i);
           ...
           ContentProviderRecord dst = r.pubProviders.<span class="hljs-keyword">get</span>(src.info.name);
           <span class="hljs-keyword">if</span> (dst != <span class="hljs-keyword">null</span>) {
               ComponentName comp = <span class="hljs-keyword">new</span> ComponentName(dst.info.packageName, dst.info.name);

               mProviderMap.putProviderByClass(comp, dst); <span class="hljs-comment">//&#x5C06;&#x8BE5;provider&#x6DFB;&#x52A0;&#x5230;mProviderMap</span>
               <span class="hljs-built_in">String</span> names[] = dst.info.authority.split(<span class="hljs-string">&quot;;&quot;</span>);
               <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> j = <span class="hljs-number">0</span>; j &lt; names.length; j++) {
                   mProviderMap.putProviderByName(names[j], dst);
               }

               <span class="hljs-built_in">int</span> launchingCount = mLaunchingProviders.size();
               <span class="hljs-built_in">int</span> j;
               boolean wasInLaunchingProviders = <span class="hljs-keyword">false</span>;
               <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; launchingCount; j++) {
                   <span class="hljs-keyword">if</span> (mLaunchingProviders.<span class="hljs-keyword">get</span>(j) == dst) {
                       <span class="hljs-comment">//&#x5C06;&#x8BE5;provider&#x79FB;&#x9664;mLaunchingProviders&#x961F;&#x5217;</span>
                       mLaunchingProviders.remove(j);
                       wasInLaunchingProviders = <span class="hljs-keyword">true</span>;
                       j--;
                       launchingCount--;
                   }
               }
               <span class="hljs-comment">//&#x6210;&#x529F;pubish&#x5219;&#x79FB;&#x9664;&#x8BE5;&#x6D88;&#x606F;</span>
               <span class="hljs-keyword">if</span> (wasInLaunchingProviders) {
                   mHandler.removeMessages(CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG, r);
               }
               synchronized (dst) {
                   dst.provider = src.provider;
                   dst.proc = r;
                   <span class="hljs-comment">//&#x5524;&#x9192;&#x5BA2;&#x6237;&#x7AEF;&#x7684;wait&#x7B49;&#x5F85;&#x65B9;&#x6CD5;</span>
                   dst.notifyAll();
               }
               ...
           }
       }
   }    
}
</code></pre>
<h3 id="43-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><a name="43-&#x5F15;&#x7206;&#x70B8;&#x5F39;" class="anchor-navigation-ex-anchor" href="#43-&#x5F15;&#x7206;&#x70B8;&#x5F39;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.3. 4.3 &#x5F15;&#x7206;&#x70B8;&#x5F39;</h3>
<p>&#x5728;system_server&#x8FDB;&#x7A0B;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;Handler&#x7EBF;&#x7A0B;, &#x540D;&#x53EB;&#x201D;ActivityManager&#x201D;.&#x5F53;&#x5012;&#x8BA1;&#x65F6;&#x7ED3;&#x675F;&#x4FBF;&#x4F1A;&#x5411;&#x8BE5;Handler&#x7EBF;&#x7A0B;&#x53D1;&#x9001; &#x4E00;&#x6761;&#x4FE1;&#x606F;CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG,</p>
<h4 id="431-mainhandlerhandlemessage"><a name="431-mainhandlerhandlemessage" class="anchor-navigation-ex-anchor" href="#431-mainhandlerhandlemessage"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.1 MainHandler.handleMessage</h4>
<p>[-&gt; ActivityManagerService.java ::MainHandler]</p>
<pre><code class="lang-java"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
        <span class="hljs-keyword">switch</span> (msg.what) {
            <span class="hljs-keyword">case</span> CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG: {
                ...
                ProcessRecord app = (ProcessRecord)msg.obj;
                <span class="hljs-keyword">synchronized</span> (ActivityManagerService.<span class="hljs-keyword">this</span>) {
                    <span class="hljs-comment">//&#x3010;&#x89C1;&#x5C0F;&#x8282;4.3.2&#x3011;</span>
                    processContentProviderPublishTimedOutLocked(app);
                }
            } <span class="hljs-keyword">break</span>;
            ...
        }
        ...
    }
}
</code></pre>
<h4 id="432-amsprocesscontentproviderpublishtimedoutlocked"><a name="432-amsprocesscontentproviderpublishtimedoutlocked" class="anchor-navigation-ex-anchor" href="#432-amsprocesscontentproviderpublishtimedoutlocked"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2 AMS.processContentProviderPublishTimedOutLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processContentProviderPublishTimedOutLocked</span><span class="hljs-params">(ProcessRecord app)</span> </span>{
    cleanupAppInLaunchingProvidersLocked(app, <span class="hljs-keyword">true</span>); <span class="hljs-comment">//[&#x89C1;4.3.3]</span>
    <span class="hljs-comment">//[&#x89C1;&#x5C0F;&#x8282;4.3.4]</span>
    removeProcessLocked(app, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;timeout publishing content providers&quot;</span>);
}
</code></pre>
<h4 id="433-amscleanupappinlaunchingproviderslocked"><a name="433-amscleanupappinlaunchingproviderslocked" class="anchor-navigation-ex-anchor" href="#433-amscleanupappinlaunchingproviderslocked"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3 AMS.cleanupAppInLaunchingProvidersLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">cleanupAppInLaunchingProvidersLocked</span><span class="hljs-params">(ProcessRecord app, <span class="hljs-keyword">boolean</span> alwaysBad)</span> </span>{
    <span class="hljs-keyword">boolean</span> restart = <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = mLaunchingProviders.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        ContentProviderRecord cpr = mLaunchingProviders.get(i);
        <span class="hljs-keyword">if</span> (cpr.launchingApp == app) {
            <span class="hljs-keyword">if</span> (!alwaysBad &amp;&amp; !app.bad &amp;&amp; cpr.hasConnectionOrHandle()) {
                restart = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//&#x79FB;&#x9664;&#x6B7B;&#x4EA1;&#x7684;provider</span>
                removeDyingProviderLocked(app, cpr, <span class="hljs-keyword">true</span>);
            }
        }
    }
    <span class="hljs-keyword">return</span> restart;
}
</code></pre>
<p>removeDyingProviderLocked()&#x7684;&#x529F;&#x80FD;&#x8DDF;&#x8FDB;&#x7A0B;&#x7684;&#x5B58;&#x6D3B;&#x606F;&#x606F;&#x76F8;&#x5173;&#xFF1A;&#x8BE6;&#x89C1;<a href="http://gityuan.com/2016/05/03/content_provider_release/" target="_blank">ContentProvider&#x5F15;&#x7528;&#x8BA1;&#x6570;</a> []&#x5C0F;&#x8282;4.5]</p>
<ul>
<li>&#x5BF9;&#x4E8E;stable&#x7C7B;&#x578B;&#x7684;provider(&#x5373;conn.stableCount &gt; 0),&#x5219;&#x4F1A;&#x6740;&#x6389;&#x6240;&#x6709;&#x8DDF;&#x8BE5;provider&#x5EFA;&#x7ACB;stable&#x8FDE;&#x63A5;&#x7684;&#x975E;persistent&#x8FDB;&#x7A0B;.</li>
<li>&#x5BF9;&#x4E8E;unstable&#x7C7B;&#x7684;provider(&#x5373;conn.unstableCount &gt; 0),&#x5E76;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;client&#x8FDB;&#x7A0B;&#x88AB;&#x7EA7;&#x8054;&#x6240;&#x6740;.</li>
</ul>
<h4 id="434-amsremoveprocesslocked"><a name="434-amsremoveprocesslocked" class="anchor-navigation-ex-anchor" href="#434-amsremoveprocesslocked"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.4 AMS.removeProcessLocked</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeProcessLocked</span><span class="hljs-params">(ProcessRecord app, <span class="hljs-keyword">boolean</span> callerWillRestart, <span class="hljs-keyword">boolean</span> allowRestart, String reason)</span> </span>{
    <span class="hljs-keyword">final</span> String name = app.processName;
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> uid = app.uid;

    <span class="hljs-comment">//&#x79FB;&#x9664;mProcessNames&#x4E2D;&#x7684;&#x76F8;&#x5E94;&#x5BF9;&#x8C61;</span>
    removeProcessNameLocked(name, uid);
    <span class="hljs-keyword">if</span> (mHeavyWeightProcess == app) {
        mHandler.sendMessage(mHandler.obtainMessage(CANCEL_HEAVY_NOTIFICATION_MSG,
                mHeavyWeightProcess.userId, <span class="hljs-number">0</span>));
        mHeavyWeightProcess = <span class="hljs-keyword">null</span>;
    }
    <span class="hljs-keyword">boolean</span> needRestart = <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">if</span> (app.pid &gt; <span class="hljs-number">0</span> &amp;&amp; app.pid != MY_PID) {
        <span class="hljs-keyword">int</span> pid = app.pid;
        <span class="hljs-keyword">synchronized</span> (mPidsSelfLocked) {
            mPidsSelfLocked.remove(pid);
            mHandler.removeMessages(PROC_START_TIMEOUT_MSG, app);
        }

        ...
        <span class="hljs-keyword">boolean</span> willRestart = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">if</span> (app.persistent &amp;&amp; !app.isolated) {
            <span class="hljs-keyword">if</span> (!callerWillRestart) {
                willRestart = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                needRestart = <span class="hljs-keyword">true</span>;
            }
        }
        app.kill(reason, <span class="hljs-keyword">true</span>); <span class="hljs-comment">//&#x6740;&#x8FDB;&#x7A0B;</span>
        handleAppDiedLocked(app, willRestart, allowRestart);
        <span class="hljs-keyword">if</span> (willRestart) {
            removeLruProcessLocked(app);
            addAppLocked(app.info, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span> <span class="hljs-comment">/* ABI override */</span>);
        }
    } <span class="hljs-keyword">else</span> {
        mRemovedProcesses.add(app);
    }
    <span class="hljs-keyword">return</span> needRestart;
}
</code></pre>
<h2 id="&#x4E94;&#x3001;anr&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;"><a name="&#x4E94;&#x3001;anr&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;" class="anchor-navigation-ex-anchor" href="#&#x4E94;&#x3001;anr&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5. &#x4E94;&#x3001;ANR&#x5E38;&#x89C1;&#x7C7B;&#x578B;&#x5F52;&#x7EB3;</h2>
<h3 id="51-&#x4E3B;&#x7EBF;&#x7A0B;binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;"><a name="51-&#x4E3B;&#x7EBF;&#x7A0B;binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;" class="anchor-navigation-ex-anchor" href="#51-&#x4E3B;&#x7EBF;&#x7A0B;binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.1. 5.1 &#x4E3B;&#x7EBF;&#x7A0B;Binder&#x8C03;&#x7528;&#x7B49;&#x5F85;&#x8D85;&#x65F6;</h3>
<p>&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x6BB5;</p>
<p><img src="media/2804698-c4086fb17e4113c8.png" alt="img"></p>
<p>&#x200B;                                                                                                                1_binder&#x7B49;&#x5F85;&#x8D85;&#x65F6;.png</p>
<p>&#x5F88;&#x660E;&#x663E;&#x5F53;&#x65F6;&#x5728;&#x505A;Binder&#x901A;&#x4FE1;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;waiting to lock&#x7B49;&#x4EE3;&#x8868;&#x6B7B;&#x9501;&#x7684;&#x5B57;&#x6837;&#xFF0C;&#x90A3;&#x4E48;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x5373;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x7B49;Binder&#x5BF9;&#x7AEF;&#x54CD;&#x5E94;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;Binder&#x901A;&#x4FE1;&#x5BF9;&#x4E8E;&#x53D1;&#x8D77;&#x65B9;&#x6765;&#x8BF4;&#x662F;&#x9ED8;&#x8BA4;&#x662F;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x54CD;&#x5E94;&#xFF0C;&#x53EA;&#x6709;&#x6709;&#x4E86;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x540E;&#x624D;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x53BB;&#xFF0C;&#x5F53;&#x7136;&#x4E86;&#x53EF;&#x4EE5;&#x7ED9;&#x63A5;&#x53E3;&#x8BBE;&#x7F6E;oneway&#x58F0;&#x660E;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;binder&#x8BF7;&#x6C42;&#x5C31;&#x662F;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x591A;&#x8BF4;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x4E0A;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#x9700;&#x8981;&#x627E;&#x5230;&#x5BF9;&#x7AEF;&#x662F;&#x54EA;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x5F53;&#x65F6;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x627E;&#x5230;anr&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;binderinfo&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x627E;&#x5230;&#x4E0E;&#x6211;&#x4EEC;&#x53D1;&#x8D77;&#x65B9;&#x8FDB;&#x7A0B;1461&#x901A;&#x4FE1;&#x7684;&#x662F;&#x54EA;&#x4E2A;&#x8FDB;&#x7A0B;</p>
<p><img src="media/2804698-04253f48615b31bc.png" alt="img"></p>
<p>&#x200B;                                                                                                                2_binder&#x7B49;&#x5F85;&#x8D85;&#x65F6;.png</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x662F;1666&#x53F7;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x518D;&#x56DE;&#x5230;trace&#x4E2D;&#x770B;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x5F53;&#x65F6;&#x5728;&#x505A;&#x4EC0;&#x4E48;</p>
<p><img src="media/2804698-b4ca2c71cd98dab0.png" alt="img"></p>
<p>&#x200B;                                                                                                                3_binder&#x7B49;&#x5F85;&#x8D85;&#x65F6;.png</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x65F6;&#x5BF9;&#x7AEF;&#x5728;&#x505A;&#x6D88;&#x606F;&#x7684;&#x8BFB;&#x53D6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x91CC;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x4FEE;&#x6539;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E86;Binder&#x8BF7;&#x6C42;&#xFF0C;&#x5BF9;&#x7AEF;&#x8FDF;&#x8FDF;&#x672A;&#x8FD4;&#x56DE;&#x4FBF;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x524D;&#x505A;&#x6CD5;&#x5F02;&#x6B65;&#x4E2D;&#x6267;&#x884C;</p>
<h3 id="52-&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;"><a name="52-&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;" class="anchor-navigation-ex-anchor" href="#52-&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.2. 5.2 &#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;</h3>
<p>&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;CallStack&#x4F8B;&#x5B50;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<p><img src="media/2804698-53970ee67114c10d.png" alt="img"></p>
<p>&#x200B;                                                                                                        4_&#x4E3B;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x9501;.png</p>
<p>&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;gallery&#x7684;main thread&#x5728;&#x6267;&#x884C;UploaderChimeraService&#x7684;onDestroy&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x9700;&#x8981;lock 0x23f65d8b&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;lock&#x6709;&#x88AB;upload_periodic GCM Task &#x62FF;&#x4F4F;&#xFF0C;&#x8FD9;&#x4E2A;thread&#x5F53;&#x524D;&#x662F;&#x5728;&#x505A;&#x8FDE;&#x63A5;&#x7F51;&#x7EDC;&#x7684;&#x52A8;&#x4F5C;&#x3002;&#x4ECE;&#x8FD9;&#x6BB5;&#x4FE1;&#x606F;&#x6765;&#x770B;&#xFF0C;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x4E0E;&#x6D4B;&#x8BD5;&#x65F6;&#x624B;&#x673A;&#x8FDE;&#x63A5;&#x7684;&#x7F51;&#x7EDC;&#x6709;&#x5173;&#xFF0C;&#x5F53;&#x65F6;&#x8FDE;&#x63A5;&#x7684;&#x4E8B;google&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x7531;&#x4E8E;&#x5899;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;gms&#x7684;&#x76F8;&#x5173;server&#x6709;&#x5173;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x5C31;&#x662F;&#x6B7B;&#x9501;&#xFF0C;&#x5373;&#x5F62;&#x6210;&#x4E86;&#x5934;&#x5C3E;&#x76F8;&#x8FDE;&#xFF0C;&#x4E92;&#x76F8;&#x7B49;&#x5F85;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x4EE5;&#x53CA;&#x4E0A;&#x9762;&#x6848;&#x4F8B;&#x7684;&#x89E3;&#x51B3;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5C1D;&#x8BD5;&#x5C06;&#x9501;&#x6539;&#x4E3A;&#x8D85;&#x65F6;&#x9501;&#xFF0C;&#x6BD4;&#x5982;lock&#x7684;trylock&#xFF0C;&#x8D85;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x4E00;&#x76F4;&#x6301;&#x6709;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x53D1;&#x751F;</p>
<h3 id="53-&#x5361;&#x5728;io&#x4E0A;"><a name="53-&#x5361;&#x5728;io&#x4E0A;" class="anchor-navigation-ex-anchor" href="#53-&#x5361;&#x5728;io&#x4E0A;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.3. 5.3 &#x5361;&#x5728;IO&#x4E0A;</h3>
<p> &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E00;&#x822C;&#x662F;&#x548C;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x76F8;&#x5173;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;mainlog&#x4E2D;&#x641C;&#x7D22;&#x5173;&#x952E;&#x5B57;&quot;ANR in&quot;,&#x770B;&#x8FD9;&#x6BB5;&#x4FE1;&#x606F;&#x7684;&#x6700;&#x4E0B;&#x8FB9;&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4FE1;&#x606F;
 ANRManager: 100% TOTAL: 2% user + 2.1% kernel + 95% iowait + 0.1% softirq
 &#x5F88;&#x660E;&#x663E;&#xFF0C;IO&#x5360;&#x6BD4;&#x5F88;&#x9AD8;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x67E5;&#x770B;trace&#x65E5;&#x5FD7;&#x770B;&#x5F53;&#x65F6;&#x7684;callstack&#xFF0C;&#x6216;&#x8005;&#x5728;&#x8FD9;&#x6BB5;ANR&#x70B9;&#x5F80;&#x524D;&#x770B;0~4s&#xFF0C;&#x770B;&#x770B;&#x5F53;&#x65F6;&#x505A;&#x7684;&#x4EC0;&#x4E48;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x6709;&#x9047;&#x5230;&#x8FC7;&#xFF0C;&#x5E38;&#x89C1;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#x5BF9;&#x8017;&#x65F6;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x91C7;&#x53D6;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;</p>
<h3 id="54-&#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;"><a name="54-&#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;" class="anchor-navigation-ex-anchor" href="#54-&#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.4. 5.4 &#x4E3B;&#x7EBF;&#x7A0B;&#x6709;&#x8017;&#x65F6;&#x7684;&#x52A8;&#x4F5C;</h3>
<p> &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;ANR&#x7C7B;&#x578B;&#x95EE;&#x9898;&#x91CC;&#x9047;&#x5230;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#xFF0C;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x90FD;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x4E3B;&#x7EBF;&#x7A0B;&#x5835;&#x585E;&#xFF0C;</p>
<p>&#x8FD9;&#x91CC;&#x4EE5;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x7C7B;&#x578B;&#x5F15;&#x8D77;&#x7684;ANR&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BB2;&#x770B;&#x5F53;&#x65F6;&#x7684;CPU&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x4F1A;&#x53D1;&#x73B0;user&#x5360;&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x770B;trace&#x4E2D;&#x4E3B;&#x7EBF;&#x7A0B;&#x5F53;&#x65F6;&#x7684;&#x4FE1;&#x606F;&#x4F1A;&#x53D1;&#x73B0;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x6BD4;&#x5982;query&#x50CF;ContentProvider&#x8FD9;&#x79CD;&#x6570;&#x636E;&#x5E93;&#x7684;&#x52A8;&#x4F5C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x53BB;&#x770B;eventlog&#x6216;&#x8005;mainlog&#xFF0C;&#x5728;ANR&#x53D1;&#x751F;&#x524D;&#x540E;&#x6253;&#x5370;&#x51FA;&#x6765;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x8FD9;&#x79CD;&#xFF0C;&#x5728;eventlog&#x4E2D;&#x641C;&#x7D22;&quot;am_anr&quot;,&#x7136;&#x540E;&#x770B;&#x524D;&#x540E;&#x7247;&#x6BB5;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x53D1;&#x751F;ANR&#x7684;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x6709;&#x5F88;&#x591A;&#x6570;&#x636E;&#x5E93;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x8BF4;&#x660E;&#x5728;&#x53D1;&#x751F;ANR&#x524D;&#x540E;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E00;&#x76F4;&#x5728;&#x5FD9;&#x4E8E;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x7C7B;&#x578B;&#x7684;&#x95EE;&#x9898;&#x5E38;&#x89C1;&#x4E8E;&#x56FE;&#x5E93;&#xFF0C;&#x8054;&#x7CFB;&#x4EBA;&#xFF0C;&#x5F69;&#x77ED;&#x4FE1;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#xFF0C;&#x4E00;&#x822C;&#x8003;&#x8651;&#x7684;&#x662F;&#x5F02;&#x6B65;&#x89E3;&#x51B3;&#xFF0C;&#x5F02;&#x6B65;&#x89E3;&#x51B3;&#x5E76;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;new&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x8981;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4EE5;&#x53CA;&#x9891;&#x7387;&#x6765;&#x51B3;&#x5B9A;&#xFF0C;Android&#x5E38;&#x89C1;&#x7684;&#x5F02;&#x6B65;AsyncTask, IntentService, &#x7EBF;&#x7A0B;&#x6C60;(&#x5B98;&#x65B9;&#x56DB;&#x79CD;&#x6216;&#x81EA;&#x5B9A;&#x4E49;), new thread&#x7B49;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x4E0D;&#x5EFA;&#x8BAE;&#x76F4;&#x63A5;new thread</p>
<h3 id="55-binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;"><a name="55-binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;" class="anchor-navigation-ex-anchor" href="#55-binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.5. 5.5 binder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;</h3>
<p> &#x7CFB;&#x7EDF;&#x5BF9;&#x6BCF;&#x4E2A;process&#x6700;&#x591A;&#x5206;&#x914D;15&#x4E2A;binder&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x8C37;&#x6B4C;&#x7684;&#x8BBE;&#x8BA1;&#xFF08;/frameworks/native/libs/binder/ProcessState.cpp)
 &#x5982;&#x679C;&#x53E6;&#x4E00;&#x4E2A;process&#x53D1;&#x9001;&#x592A;&#x591A;&#x91CD;&#x590D;binder&#x8BF7;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x63A5;&#x6536;&#x7AEF;binder&#x7EBF;&#x7A0B;&#x88AB;&#x5360;&#x6EE1;&#xFF0C;&#x4ECE;&#x800C;&#x5904;&#x7406;&#x4E0D;&#x4E86;&#x5176;&#x5B83;&#x7684;binder&#x8BF7;&#x6C42;
 &#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x8BF7;&#x6C42;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x5C31;&#x4F1A;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x4E86;(&#x672A;&#x8BBE;&#x7F6E;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x524D;&#x63D0;&#x4E0B;)&#xFF0C;&#x8FD9;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x5982;&#x679C;&#x5E94;&#x7528;&#x672A;&#x6309;&#x7167;&#x7CFB;&#x7EDF;&#x7684;&#x8981;&#x6C42;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;&#x903B;&#x8F91;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x95EE;&#x9898;&#x3002;
 &#x800C;&#x7CFB;&#x7EDF;&#x7AEF;&#x662F;&#x4E0D;&#x4F1A;&#xFF08;&#x4E5F;&#x4E0D;&#x5EFA;&#x8BAE;&#xFF09;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x6765;&#x517C;&#x5BB9;&#x5E94;&#x7528;&#x903B;&#x8F91;&#xFF0C;&#x5426;&#x5219;&#x66F4;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x5176;&#x5B83;&#x6839;&#x636E;&#x7CFB;&#x7EDF;&#x9700;&#x6C42;&#x6B63;&#x5E38;&#x7F16;&#x5199;&#x7684;&#x5E94;&#x7528;&#x53CD;&#x800C;&#x51FA;&#x73B0;&#x4E0D;&#x53EF;&#x9884;&#x6599;&#x7684;&#x95EE;&#x9898;&#x3002;
 &#x5224;&#x65AD;Binder&#x662F;&#x5426;&#x7528;&#x5B8C;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;trace&#x4E2D;&#x641C;&#x7D22;&#x5173;&#x952E;&#x5B57;&quot;binder_f&quot;&#xFF0C;&#x5982;&#x679C;&#x641C;&#x7D22;&#x5230;&#x5219;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x7528;&#x5B8C;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x8981;&#x627E;log&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x770B;&#x662F;&#x8C01;&#x4E00;&#x76F4;&#x5728;&#x6D88;&#x8017;binder&#x6216;&#x8005;&#x662F;&#x6709;&#x6B7B;&#x9501;&#x53D1;&#x751F;</p>
<p>&#x4E4B;&#x524D;&#x6709;&#x9047;&#x5230;&#x8FC7;&#x538B;&#x529B;&#x6D4B;&#x8BD5;&#x624B;&#x7535;&#x7B52;&#x5E94;&#x7528;&#xFF0C;&#x51FA;&#x73B0;BInder&#x7EBF;&#x7A0B;&#x6C60;&#x88AB;&#x5360;&#x6EE1;&#x60C5;&#x51B5;&#xFF0C;&#x89E3;&#x51B3;&#x7684;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x964D;&#x4F4E;&#x6781;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x5927;&#x91CF;Binder&#x8BF7;&#x6C42;&#x7684;&#x53D1;&#x751F;&#xFF0C;&#x4FEE;&#x590D;&#x7684;&#x624B;&#x6CD5;&#x662F;&#x53D1;&#x9001;BInder&#x8BF7;&#x6C42;&#x7684;&#x51FD;&#x6570;&#x4E2D;&#x505A;&#x65F6;&#x95F4;&#x5DEE;&#x8FC7;&#x6EE4;&#xFF0C;&#x9650;&#x5B9A;&#x5728;500ms&#x5185;&#x6700;&#x591A;&#x6267;&#x884C;&#x4E00;&#x6B21;</p>
<h3 id="56-je&#x6216;&#x8005;ne&#x5BFC;&#x81F4;anr"><a name="56-je&#x6216;&#x8005;ne&#x5BFC;&#x81F4;anr" class="anchor-navigation-ex-anchor" href="#56-je&#x6216;&#x8005;ne&#x5BFC;&#x81F4;anr"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.6. 5.6 JE&#x6216;&#x8005;NE&#x5BFC;&#x81F4;ANR</h3>
<p>&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x6709;&#x9047;&#x5230;&#x8FC7;&#xFF0C;ANR&#x524D;&#x51FA;&#x73B0;&#x9891;&#x7E41;NE&#xFF0C;NE&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x4E0E;ANR&#x7684;&#x8FDB;&#x7A0B;&#x6709;&#x4EA4;&#x4E92;&#xFF0C;&#x5728;&#x89E3;&#x51B3;&#x4E86;NE&#x540E;&#xFF0C;ANR&#x4E5F;&#x4E0D;&#x590D;&#x5B58;&#x5728;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x7C7B;&#x5728;ANR&#x524D;&#x6709;JE&#x6216;&#x8005;NE&#xFF0C;&#x4E00;&#x822C;&#x601D;&#x8DEF;&#x662F;&#x5148;&#x89E3;&#x51B3;JE&#x6216;NE&#xFF0C;&#x56E0;&#x4E3A;JE/NE&#x53D1;&#x751F;&#x65F6;&#x4F1A;&#x53BB;dump&#x4E00;&#x5927;&#x5806;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#xFF0C;&#x672C;&#x8EAB;&#x4E5F;&#x4F1A;&#x52A0;&#x91CD;CPU loading&#xFF0C;&#x4FEE;&#x6539;&#x5B8C;&#x5F02;&#x5E38;&#x540E;&#x518D;&#x6765;&#x770B;ANR&#x662F;&#x5426;&#x8FD8;&#x5B58;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x770B;trace &#x5806;&#x6808;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x57FA;&#x672C;&#x5224;&#x5B9A;&#x662F;JE&#x6216;NE&#x5BFC;&#x81F4;</p>
<h3 id="57-&#x53EA;&#x5B58;&#x5728;&#x4E8E;monkey&#x6D4B;&#x8BD5;&#x4E0B;"><a name="57-&#x53EA;&#x5B58;&#x5728;&#x4E8E;monkey&#x6D4B;&#x8BD5;&#x4E0B;" class="anchor-navigation-ex-anchor" href="#57-&#x53EA;&#x5B58;&#x5728;&#x4E8E;monkey&#x6D4B;&#x8BD5;&#x4E0B;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.7. 5.7 &#x53EA;&#x5B58;&#x5728;&#x4E8E;Monkey&#x6D4B;&#x8BD5;&#x4E0B;</h3>
<p> &#x6709;&#x4E9B;&#x95EE;&#x9898;&#x662F;&#x53EA;&#x6709;&#x5728;Monkey&#x73AF;&#x5883;&#x4E0B;&#x624D;&#x80FD;&#x8DD1;&#x51FA;&#x6765;&#xFF0C;&#x5E73;&#x65F6;&#x7684;user&#x7248;&#x672C;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x662F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7684;&#xFF0C;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x7684;&#x8BDD;&#x5C31;&#x6CA1;&#x6709;&#x6539;&#x52A8;&#x7684;&#x610F;&#x4E49;&#x3002;
 &#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code>ActivityManager: Not finishing activity because controller resumed
 03-18 07:25:50.901 810 870 I am_anr : [0,25443,android.process.media,1086897733,Input dispatching timed out (Waiting because no window has focus but there is a focused application that may eventually add a window when it finishes starting up.)]
</code></pre><p> &#x53D1;&#x751F;&#x8FD9;&#x4E2A;ANR&#x7684;&#x539F;&#x56E0;&#x662F;Contoller&#x5C06;resume&#x7684;&#x64CD;&#x4F5C;&#x7ED9;&#x62E6;&#x622A;&#x4E86;, &#x5BFC;&#x81F4;Focus&#x4E0D;&#x8FC7;&#x53BB;, &#x4ECE;&#x800C;&#x5BFC;&#x81F4;ANR&#xFF0C;User&#x7248;&#x672C;&#x4E0D;&#x4F1A;&#x6709;Contoller, &#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x4E2A; ANR. &#x6240;&#x4EE5;&#x8FD9;&#x4E2A; ANR &#x53EF;&#x4EE5;&#x5FFD;&#x7565;.</p>
<h2 id="&#x516D;&#x3001;-tracetxt"><a name="&#x516D;&#x3001;-tracetxt" class="anchor-navigation-ex-anchor" href="#&#x516D;&#x3001;-tracetxt"><i class="fa fa-link" aria-hidden="true"></i></a>1.6. &#x516D;&#x3001; Trace.txt</h2>
<h3 id="61-&#x5BFC;&#x51FA;tracestxt&#x6587;&#x4EF6;"><a name="61-&#x5BFC;&#x51FA;tracestxt&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#61-&#x5BFC;&#x51FA;tracestxt&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>1.6.1. 6.1 &#x5BFC;&#x51FA;traces.txt&#x6587;&#x4EF6;</h3>
<p><code>traces.txt</code>&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#x5728;<code>/data/anr/</code>&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;<code>adb</code>&#x547D;&#x4EE4;&#x5C06;&#x5176;&#x62F7;&#x8D1D;&#x5230;sd&#x5361;&#x76EE;&#x5F55;&#x4E0B;&#x83B7;&#x53D6;&#x67E5;&#x770B;&#x3002;</p>
<pre><code>adb shell
cat  /data/anr/traces.txt  &gt;/mnt/sdcard/traces.txt  
exit
&#x6216;&#x8005;
adb pull /data/anr/traces/txt
</code></pre><h3 id="62-tracestxt&#x6587;&#x4EF6;&#x5206;&#x6790;"><a name="62-tracestxt&#x6587;&#x4EF6;&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#62-tracestxt&#x6587;&#x4EF6;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>1.6.2. 6.2 traces.txt&#x6587;&#x4EF6;&#x5206;&#x6790;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) {
    Log.d(<span class="hljs-string">&quot;TAG&quot;</span>, <span class="hljs-string">&quot;ANR log&quot;</span>);
}
</code></pre>
<p>&#x200B;    <code>traces.txt</code>&#x91CC;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code>----- pid 4456 at 1970-01-12 19:50:20 -----
Cmd line: com.android.health
Build fingerprint: &apos;qcom/msm8937_32go/msm8937_32go:8.1.0/OPM1.171019.026/userdebug/test-keys&apos;
ABI: &apos;arm&apos;
Build type: optimized
Zygote loaded classes=5031 post zygote classes=222
Intern table: 66389 strong; 129 weak
JNI: CheckJNI is off; globals=493 (plus 28 weak)
Libraries: /data/app/com.android.health-joSF2Y7Vhc9-Y83j6TihZQ==/lib/arm/librstate-jni.so /system/lib/libandroid.so /system/lib/libcompiler_rt.so /system/lib/libjavacrypto.so /system/lib/libjnigraphics.so /system/lib/libmedia_jni.so /system/lib/libsoundpool.so /system/lib/libwebviewchromium_loader.so libjavacore.so libopenjdk.so (10)
Heap: 19% free, 2MB/2MB; 48359 objects
Dumping cumulative Gc timings
Start Dumping histograms for 44 iterations for concurrent copying
VisitConcurrentRoots:    Sum: 201.728ms 99% C.I. 3.775ms-14.591ms Avg: 4.584ms Max: 15.852ms
ProcessMarkStack:    Sum: 123.361ms 99% C.I. 2.118ms-6.847ms Avg: 2.803ms Max: 6.870ms
ClearFromSpace:    Sum: 81.525ms 99% C.I. 1.311ms-7.295ms Avg: 1.852ms Max: 7.531ms
ScanImmuneSpaces:    Sum: 81.131ms 99% C.I. 1.607ms-2.744ms Avg: 1.843ms Max: 2.744ms
InitializePhase:    Sum: 12.579ms 99% C.I. 209us-911.999us Avg: 285.886us Max: 941us
FlipOtherThreads:    Sum: 7.389ms 99% C.I. 107us-511us Avg: 167.931us Max: 511us
GrayAllDirtyImmuneObjects:    Sum: 5.270ms 99% C.I. 93us-416.999us Avg: 119.772us Max: 447us
VisitNonThreadRoots:    Sum: 5.093ms 99% C.I. 85us-767.999us Avg: 115.750us Max: 838us
RecordFree:    Sum: 4.890ms 99% C.I. 68us-1145.999us Avg: 111.136us Max: 1210us
EnqueueFinalizerReferences:    Sum: 4.225ms 99% C.I. 64us-901.999us Avg: 96.022us Max: 1052us
SweepSystemWeaks:    Sum: 3.760ms 99% C.I. 66us-472.999us Avg: 85.454us Max: 534us
FlipThreadRoots:    Sum: 3.629ms 99% C.I. 2us-477.999us Avg: 82.477us Max: 493us
MarkZygoteLargeObjects:    Sum: 3.303ms 99% C.I. 58us-220us Avg: 75.068us Max: 220us
ThreadListFlip:    Sum: 1.873ms 99% C.I. 22us-305.999us Avg: 42.568us Max: 307us
ResumeRunnableThreads:    Sum: 1.725ms 99% C.I. 18us-169us Avg: 39.204us Max: 169us
ForwardSoftReferences:    Sum: 1.539ms 99% C.I. 28us-134us Avg: 34.977us Max: 134us
MarkingPhase:    Sum: 1.513ms 99% C.I. 18us-411.999us Avg: 34.386us Max: 491us
MarkStackAsLive:    Sum: 1.262ms 99% C.I. 16us-154us Avg: 28.681us Max: 154us
(Paused)GrayAllNewlyDirtyImmuneObjects:    Sum: 1.206ms 99% C.I. 24us-75us Avg: 27.409us Max: 75us
EmptyRBMarkBitStack:    Sum: 1.135ms 99% C.I. 17us-166.999us Avg: 25.795us Max: 176us
ClearRegionSpaceCards:    Sum: 1.098ms 99% C.I. 19us-40us Avg: 24.954us Max: 40us
SweepLargeObjects:    Sum: 940us 99% C.I. 16us-155us Avg: 21.363us Max: 155us
ReclaimPhase:    Sum: 867us 99% C.I. 11us-132us Avg: 19.704us Max: 132us
SwapBitmaps:    Sum: 608us 99% C.I. 11us-49us Avg: 13.818us Max: 49us
ProcessReferences:    Sum: 466us 99% C.I. 2us-14us Avg: 5.295us Max: 14us
(Paused)SetFromSpace:    Sum: 223us 99% C.I. 4us-20us Avg: 5.068us Max: 20us
(Paused)FlipCallback:    Sum: 202us 99% C.I. 3us-42us Avg: 4.590us Max: 42us
SweepAllocSpace:    Sum: 162us 99% C.I. 3us-16us Avg: 3.681us Max: 16us
Sweep:    Sum: 139us 99% C.I. 3us-5us Avg: 3.159us Max: 5us
ResumeOtherThreads:    Sum: 84us 99% C.I. 1us-12us Avg: 1.909us Max: 12us
(Paused)ClearCards:    Sum: 76us 99% C.I. 250ns-16000ns Avg: 82ns Max: 16000ns
UnBindBitmaps:    Sum: 45us 99% C.I. 1us-2us Avg: 1.022us Max: 2us
Done Dumping histograms
concurrent copying paused:    Sum: 3.841ms 99% C.I. 62us-355us Avg: 87.295us Max: 355us
concurrent copying total time: 553.046ms mean time: 12.569ms
concurrent copying freed: 1886677 objects with total size 69MB
concurrent copying throughput: 3.41171e+06/s / 125MB/s
Cumulative bytes moved 2717208
Cumulative objects moved 67496
Total time spent in GC: 553.046ms
Mean GC size throughput: 125MB/s
Mean GC object throughput: 3.41143e+06 objects/s
Total number of allocations 1935034
Total bytes allocated 71MB
Total bytes freed 69MB
Free memory 512KB
Free memory until GC 512KB
Free memory until OOME 93MB
Total memory 2MB
Max memory 96MB
Zygote space size 632KB
Total mutator paused time: 3.841ms
Total time waiting for GC to complete: 53.447us
Total GC count: 44
Total GC time: 553.046ms
Total blocking GC count: 0
Total blocking GC time: 0
Histogram of GC count per 10000 ms: 31:1
Histogram of blocking GC count per 10000 ms: 0:1
Registered native bytes allocated: 71894
/data/app/com.android.health-joSF2Y7Vhc9-Y83j6TihZQ==/oat/arm/base.odex: quicken
Current JIT code cache size: 9KB
Current JIT data cache size: 5KB
Current JIT capacity: 64KB
Current number of JIT code cache entries: 11
Total number of JIT compilations: 11
Total number of JIT compilations for on stack replacement: 2
Total number of JIT code cache collections: 0
Memory used for stack maps: Avg: 383B Max: 1764B Min: 24B
Memory used for compiled code: Avg: 817B Max: 3KB Min: 2B
Memory used for profiling info: Avg: 101B Max: 496B Min: 16B
Start Dumping histograms for 11 iterations for JIT timings
Compiling:    Sum: 59.398ms 99% C.I. 0.875ms-19.545ms Avg: 5.399ms Max: 19.545ms
TrimMaps:    Sum: 2.712ms 99% C.I. 54us-978us Avg: 246.545us Max: 978us
Done Dumping histograms
Memory used for compilation: Avg: 152KB Max: 557KB Min: 17KB
ProfileSaver total_bytes_written=0
ProfileSaver total_number_of_writes=0
ProfileSaver total_number_of_code_cache_queries=0
ProfileSaver total_number_of_skipped_writes=0
ProfileSaver total_number_of_failed_writes=0
ProfileSaver total_ms_of_sleep=5000
ProfileSaver total_ms_of_work=0
ProfileSaver max_number_profile_entries_cached=0
ProfileSaver total_number_of_hot_spikes=0
ProfileSaver total_number_of_wake_ups=0

suspend all histogram:    Sum: 36.114ms 99% C.I. 5.222us-26199.040us Avg: 708.117us Max: 34796us
DALVIK THREADS (13):
&quot;main&quot; prio=5 tid=1 Runnable
  | group=&quot;main&quot; sCount=0 dsCount=0 flags=0 obj=0x7214d790 self=0xa9127000
  | sysTid=4456 nice=-10 cgrp=default sched=0/0 handle=0xad3b04a4
  | state=R schedstat=( 5539330925 126588963 1516 ) utm=392 stm=161 core=2 HZ=100
  | stack=0xbe506000-0xbe508000 stackSize=8MB
  | held mutexes= &quot;mutator lock&quot;(shared held)
  native: #00 pc 002e8247  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, int, BacktraceMap*, char const*, art::ArtMethod*, void*)+130)
  native: #01 pc 00379081  /system/lib/libart.so (art::Thread::DumpStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+204)
  native: #02 pc 003757b7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+34)
  native: #03 pc 0038d14b  /system/lib/libart.so (art::DumpCheckpoint::Run(art::Thread*)+698)
  native: #04 pc 00379c61  /system/lib/libart.so (art::Thread::RunCheckpointFunction()+284)
  native: #05 pc 003e0885  /system/lib/libart.so (art::JniMethodFastEndWithReference(_jobject*, unsigned int, art::Thread*)+28)
  native: #06 pc 00055611  /system/framework/arm/boot-core-libart.oat (Java_dalvik_system_VMStack_getCallingClassLoader__+104)
  at dalvik.system.VMStack.getCallingClassLoader(Native method)
  at java.lang.Class.forName(Class.java:378)
  at b.c.a.a.a.a.a(StringFogImpl.java:1)
  at b.f.e.b.g.a(StringFog.java:1)
  at com.android.health.ui.activity.MainActivity.onCreate(MainActivity.java:10)
  at android.app.Activity.performCreate(Activity.java:7023)
  at android.app.Activity.performCreate(Activity.java:7014)
  at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1215)
  at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2734)
  at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2859)
  at android.app.ActivityThread.-wrap11(ActivityThread.java:-1)
  at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1592)
  at android.os.Handler.dispatchMessage(Handler.java:106)
  at android.os.Looper.loop(Looper.java:164)
  at android.app.ActivityThread.main(ActivityThread.java:6518)
  at java.lang.reflect.Method.invoke(Native method)
  at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)
  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:807)

&quot;Signal Catcher&quot; daemon prio=5 tid=3 Runnable
  | group=&quot;system&quot; sCount=0 dsCount=0 flags=0 obj=0x15280148 self=0xa9128200
  | sysTid=4462 nice=0 cgrp=default sched=0/0 handle=0xa2404970
  | state=R schedstat=( 25718797 6108385 37 ) utm=1 stm=1 core=0 HZ=100
  | stack=0xa230a000-0xa230c000 stackSize=1006KB
  | held mutexes= &quot;mutator lock&quot;(shared held)
  native: #00 pc 002e8247  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, int, BacktraceMap*, char const*, art::ArtMethod*, void*)+130)
  native: #01 pc 00379081  /system/lib/libart.so (art::Thread::DumpStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+204)
  native: #02 pc 003757b7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+34)
  native: #03 pc 0038d14b  /system/lib/libart.so (art::DumpCheckpoint::Run(art::Thread*)+698)
  native: #04 pc 00386cc5  /system/lib/libart.so (art::ThreadList::RunCheckpoint(art::Closure*, art::Closure*)+320)
  native: #05 pc 003867c3  /system/lib/libart.so (art::ThreadList::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool)+530)
  native: #06 pc 003864e3  /system/lib/libart.so (art::ThreadList::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+626)
  native: #07 pc 003643c3  /system/lib/libart.so (art::Runtime::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+122)
  native: #08 pc 0036b4bf  /system/lib/libart.so (art::SignalCatcher::HandleSigQuit()+1282)
  native: #09 pc 0036a49d  /system/lib/libart.so (art::SignalCatcher::Run(void*)+240)
  native: #10 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #11 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;Jit thread pool worker thread 0&quot; daemon prio=5 tid=2 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 flags=1 obj=0x15280000 self=0xa9127c00
  | sysTid=4461 nice=9 cgrp=default sched=0/0 handle=0xa2505970
  | state=S schedstat=( 53567655 10374322 72 ) utm=1 stm=4 core=1 HZ=100
  | stack=0xa2407000-0xa2409000 stackSize=1022KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4461/stack)
  native: #00 pc 00018d98  /system/lib/libc.so (syscall+28)
  native: #01 pc 000b75cd  /system/lib/libart.so (art::ConditionVariable::WaitHoldingLocks(art::Thread*)+80)
  native: #02 pc 0038e3d1  /system/lib/libart.so (art::ThreadPool::GetTask(art::Thread*)+172)
  native: #03 pc 0038dd47  /system/lib/libart.so (art::ThreadPoolWorker::Run()+62)
  native: #04 pc 0038d965  /system/lib/libart.so (art::ThreadPoolWorker::Callback(void*)+92)
  native: #05 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #06 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;JDWP&quot; daemon prio=5 tid=4 WaitingInMainDebuggerLoop
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x152801d0 self=0xa9128800
  | sysTid=4463 nice=0 cgrp=default sched=0/0 handle=0x92cc6970
  | state=S schedstat=( 2252710 2346719 9 ) utm=0 stm=0 core=0 HZ=100
  | stack=0x92bcc000-0x92bce000 stackSize=1006KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4463/stack)
  native: #00 pc 00048528  /system/lib/libc.so (__pselect6+20)
  native: #01 pc 0001f1b5  /system/lib/libc.so (select+92)
  native: #02 pc 00408217  /system/lib/libart.so (art::JDWP::JdwpAdbState::ProcessIncoming()+262)
  native: #03 pc 0025d18b  /system/lib/libart.so (art::JDWP::JdwpState::Run()+438)
  native: #04 pc 0025c917  /system/lib/libart.so (art::JDWP::StartJdwpThread(void*)+22)
  native: #05 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #06 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;FinalizerDaemon&quot; daemon prio=5 tid=5 Waiting
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x15280258 self=0x9f7a8a00
  | sysTid=4465 nice=4 cgrp=default sched=0/0 handle=0x92ac4970
  | state=S schedstat=( 8023018 3220104 59 ) utm=0 stm=0 core=1 HZ=100
  | stack=0x929c2000-0x929c4000 stackSize=1038KB
  | held mutexes=
  at java.lang.Object.wait(Native method)
  - waiting on &lt;0x09b00fe4&gt; (a java.lang.Object)
  at java.lang.Object.wait(Object.java:422)
  at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:188)
  - locked &lt;0x09b00fe4&gt; (a java.lang.Object)
  at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:209)
  at java.lang.Daemons$FinalizerDaemon.runInternal(Daemons.java:232)
  at java.lang.Daemons$Daemon.run(Daemons.java:103)
  at java.lang.Thread.run(Thread.java:764)

&quot;ReferenceQueueDaemon&quot; daemon prio=5 tid=6 Waiting
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x152803c8 self=0xa9128e00
  | sysTid=4464 nice=4 cgrp=default sched=0/0 handle=0x92bc9970
  | state=S schedstat=( 6551777 5536617 104 ) utm=0 stm=0 core=1 HZ=100
  | stack=0x92ac7000-0x92ac9000 stackSize=1038KB
  | held mutexes=
  at java.lang.Object.wait(Native method)
  - waiting on &lt;0x03266c4d&gt; (a java.lang.Class&lt;java.lang.ref.ReferenceQueue&gt;)
  at java.lang.Daemons$ReferenceQueueDaemon.runInternal(Daemons.java:178)
  - locked &lt;0x03266c4d&gt; (a java.lang.Class&lt;java.lang.ref.ReferenceQueue&gt;)
  at java.lang.Daemons$Daemon.run(Daemons.java:103)
  at java.lang.Thread.run(Thread.java:764)

&quot;FinalizerWatchdogDaemon&quot; daemon prio=5 tid=7 Sleeping
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x15280508 self=0x9f7e4000
  | sysTid=4466 nice=4 cgrp=default sched=0/0 handle=0x929bf970
  | state=S schedstat=( 632500 1089687 10 ) utm=0 stm=0 core=0 HZ=100
  | stack=0x928bd000-0x928bf000 stackSize=1038KB
  | held mutexes=
  at java.lang.Thread.sleep(Native method)
  - sleeping on &lt;0x0ce9c302&gt; (a java.lang.Object)
  at java.lang.Thread.sleep(Thread.java:373)
  - locked &lt;0x0ce9c302&gt; (a java.lang.Object)
  at java.lang.Thread.sleep(Thread.java:314)
  at java.lang.Daemons$FinalizerWatchdogDaemon.sleepFor(Daemons.java:342)
  at java.lang.Daemons$FinalizerWatchdogDaemon.waitForFinalization(Daemons.java:364)
  at java.lang.Daemons$FinalizerWatchdogDaemon.runInternal(Daemons.java:281)
  at java.lang.Daemons$Daemon.run(Daemons.java:103)
  at java.lang.Thread.run(Thread.java:764)

&quot;HeapTaskDaemon&quot; daemon prio=5 tid=8 WaitingForCheckPointsToRun
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x152817c0 self=0x9f7e4600
  | sysTid=4467 nice=4 cgrp=default sched=0/0 handle=0x928ba970
  | state=S schedstat=( 490659546 85688968 531 ) utm=40 stm=9 core=0 HZ=100
  | stack=0x927b8000-0x927ba000 stackSize=1038KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4467/stack)
  native: #00 pc 00018d98  /system/lib/libc.so (syscall+28)
  native: #01 pc 000b75cd  /system/lib/libart.so (art::ConditionVariable::WaitHoldingLocks(art::Thread*)+80)
  native: #02 pc 000b271f  /system/lib/libart.so (art::Barrier::Increment(art::Thread*, int)+48)
  native: #03 pc 00175257  /system/lib/libart.so (art::gc::collector::ConcurrentCopying::ActivateReadBarrierEntrypoints()+270)
  native: #04 pc 00174bc5  /system/lib/libart.so (art::gc::collector::ConcurrentCopying::RunPhases()+440)
  native: #05 pc 0018473d  /system/lib/libart.so (art::gc::collector::GarbageCollector::Run(art::gc::GcCause, bool)+260)
  native: #06 pc 0019e78f  /system/lib/libart.so (art::gc::Heap::CollectGarbageInternal(art::gc::collector::GcType, art::gc::GcCause, bool)+2342)
  native: #07 pc 001ac5cf  /system/lib/libart.so (art::gc::Heap::ConcurrentGC(art::Thread*, art::gc::GcCause, bool)+70)
  native: #08 pc 001b1005  /system/lib/libart.so (art::gc::Heap::ConcurrentGCTask::Run(art::Thread*)+20)
  native: #09 pc 001cb647  /system/lib/libart.so (art::gc::TaskProcessor::RunAllTasks(art::Thread*)+30)
  native: #10 pc 0005504b  /system/framework/arm/boot-core-libart.oat (Java_dalvik_system_VMRuntime_runHeapTasks__+74)
  at dalvik.system.VMRuntime.runHeapTasks(Native method)
  at java.lang.Daemons$HeapTaskDaemon.runInternal(Daemons.java:461)
  at java.lang.Daemons$Daemon.run(Daemons.java:103)
  at java.lang.Thread.run(Thread.java:764)

&quot;Binder:4456_1&quot; prio=5 tid=9 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 flags=1 obj=0x15280f68 self=0x9f7e4c00
  | sysTid=4468 nice=0 cgrp=default sched=0/0 handle=0x926b7970
  | state=S schedstat=( 1830991 109635 14 ) utm=0 stm=0 core=2 HZ=100
  | stack=0x925bd000-0x925bf000 stackSize=1006KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4468/stack)
  native: #00 pc 0004843c  /system/lib/libc.so (__ioctl+8)
  native: #01 pc 0001d965  /system/lib/libc.so (ioctl+32)
  native: #02 pc 00045643  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+170)
  native: #03 pc 00045751  /system/lib/libbinder.so (android::IPCThreadState::getAndExecuteCommand()+8)
  native: #04 pc 00045c5b  /system/lib/libbinder.so (android::IPCThreadState::joinThreadPool(bool)+38)
  native: #05 pc 0005a591  /system/lib/libbinder.so (???)
  native: #06 pc 0000d24f  /system/lib/libutils.so (android::Thread::_threadLoop(void*)+90)
  native: #07 pc 0007412d  /system/lib/libandroid_runtime.so (android::AndroidRuntime::javaThreadShell(void*)+88)
  native: #08 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #09 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;Binder:4456_2&quot; prio=5 tid=10 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 flags=1 obj=0x15281010 self=0x9f7e5200
  | sysTid=4469 nice=0 cgrp=default sched=0/0 handle=0x925ba970
  | state=S schedstat=( 2867968 7702500 12 ) utm=0 stm=0 core=1 HZ=100
  | stack=0x924c0000-0x924c2000 stackSize=1006KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4469/stack)
  native: #00 pc 0004843c  /system/lib/libc.so (__ioctl+8)
  native: #01 pc 0001d965  /system/lib/libc.so (ioctl+32)
  native: #02 pc 00045643  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+170)
  native: #03 pc 00045751  /system/lib/libbinder.so (android::IPCThreadState::getAndExecuteCommand()+8)
  native: #04 pc 00045c5b  /system/lib/libbinder.so (android::IPCThreadState::joinThreadPool(bool)+38)
  native: #05 pc 0005a591  /system/lib/libbinder.so (???)
  native: #06 pc 0000d24f  /system/lib/libutils.so (android::Thread::_threadLoop(void*)+90)
  native: #07 pc 0007412d  /system/lib/libandroid_runtime.so (android::AndroidRuntime::javaThreadShell(void*)+88)
  native: #08 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #09 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;Binder:4456_3&quot; prio=5 tid=11 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 flags=1 obj=0x15281098 self=0x9f7e5800
  | sysTid=4471 nice=0 cgrp=default sched=0/0 handle=0x924bd970
  | state=S schedstat=( 3718960 1600886 13 ) utm=0 stm=0 core=2 HZ=100
  | stack=0x923c3000-0x923c5000 stackSize=1006KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4471/stack)
  native: #00 pc 0004843c  /system/lib/libc.so (__ioctl+8)
  native: #01 pc 0001d965  /system/lib/libc.so (ioctl+32)
  native: #02 pc 00045643  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+170)
  native: #03 pc 00045751  /system/lib/libbinder.so (android::IPCThreadState::getAndExecuteCommand()+8)
  native: #04 pc 00045c5b  /system/lib/libbinder.so (android::IPCThreadState::joinThreadPool(bool)+38)
  native: #05 pc 0005a591  /system/lib/libbinder.so (???)
  native: #06 pc 0000d24f  /system/lib/libutils.so (android::Thread::_threadLoop(void*)+90)
  native: #07 pc 0007412d  /system/lib/libandroid_runtime.so (android::AndroidRuntime::javaThreadShell(void*)+88)
  native: #08 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #09 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

&quot;AppInit&quot; prio=5 tid=12 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 flags=1 obj=0x15281120 self=0x9f7e6400
  | sysTid=4476 nice=0 cgrp=default sched=0/0 handle=0x91d13970
  | state=S schedstat=( 742550 10813334 10 ) utm=0 stm=0 core=1 HZ=100
  | stack=0x91c11000-0x91c13000 stackSize=1038KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4476/stack)
  native: #00 pc 00048300  /system/lib/libc.so (__epoll_pwait+20)
  native: #01 pc 0001b0f9  /system/lib/libc.so (epoll_pwait+36)
  native: #02 pc 0001b121  /system/lib/libc.so (epoll_wait+12)
  native: #03 pc 0000fd33  /system/lib/libutils.so (android::Looper::pollInner(int)+110)
  native: #04 pc 0000fc2d  /system/lib/libutils.so (android::Looper::pollOnce(int, int*, int*, void**)+32)
  native: #05 pc 000b3b15  /system/lib/libandroid_runtime.so (android::NativeMessageQueue::pollOnce(_JNIEnv*, _jobject*, int)+24)
  native: #06 pc 000ba55d  /system/framework/arm/boot-framework.oat (Java_android_os_MessageQueue_nativePollOnce__JI+92)
  at android.os.MessageQueue.nativePollOnce(Native method)
  at android.os.MessageQueue.next(MessageQueue.java:325)
  at android.os.Looper.loop(Looper.java:142)
  at android.os.HandlerThread.run(HandlerThread.java:65)

&quot;Profile Saver&quot; daemon prio=5 tid=13 Native
  | group=&quot;system&quot; sCount=1 dsCount=0 flags=1 obj=0x15281738 self=0x9f7e6a00
  | sysTid=4475 nice=9 cgrp=default sched=0/0 handle=0x91fa1970
  | state=S schedstat=( 3156772 20836771 9 ) utm=0 stm=0 core=0 HZ=100
  | stack=0x91ea7000-0x91ea9000 stackSize=1006KB
  | held mutexes=
  kernel: (couldn&apos;t read /proc/self/task/4475/stack)
  native: #00 pc 00018d98  /system/lib/libc.so (syscall+28)
  native: #01 pc 000b75cd  /system/lib/libart.so (art::ConditionVariable::WaitHoldingLocks(art::Thread*)+80)
  native: #02 pc 00275ac7  /system/lib/libart.so (art::ProfileSaver::Run()+342)
  native: #03 pc 00277e5f  /system/lib/libart.so (art::ProfileSaver::RunProfileSaverThread(void*)+50)
  native: #04 pc 00046e53  /system/lib/libc.so (__pthread_start(void*)+22)
  native: #05 pc 0001ad15  /system/lib/libc.so (__start_thread+32)
  (no managed stack frames)

----- end 4456 -----
</code></pre><h3 id="63-traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;"><a name="63-traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;" class="anchor-navigation-ex-anchor" href="#63-traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;"><i class="fa fa-link" aria-hidden="true"></i></a>1.6.3. 6.3 traces&#x6587;&#x4EF6;&#x89E3;&#x8BFB;</h3>
<pre><code>&quot;Binder_1&quot; prio=5 tid=8 Native
  | group=&quot;main&quot; sCount=1 dsCount=0 obj=0x12c610a0 self=0x5573e5c750
  | sysTid=12092 nice=0 cgrp=default sched=0/0 handle=0x7fa2743450
  | state=S schedstat=( 796240075 863170759 3586 ) utm=50 stm=29 core=1 HZ=100
  | stack=0x7fa2647000-0x7fa2649000 stackSize=1013KB
  | held mutexes=
</code></pre><p>&#x7B2C;0&#x884C;:</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x540D;: Binder_1&#xFF08;&#x5982;&#x6709;daemon&#x5219;&#x4EE3;&#x8868;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;)</li>
<li>prio: &#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;</li>
<li>tid: &#x7EBF;&#x7A0B;&#x5185;&#x90E8;id</li>
<li>&#x7EBF;&#x7A0B;&#x72B6;&#x6001;: NATIVE</li>
</ul>
<p>&#x7B2C;1&#x884C;:</p>
<ul>
<li>group: &#x7EBF;&#x7A0B;&#x6240;&#x5C5E;&#x7684;&#x7EBF;&#x7A0B;&#x7EC4;</li>
<li>sCount: &#x7EBF;&#x7A0B;&#x6302;&#x8D77;&#x6B21;&#x6570;</li>
<li>dsCount: &#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x7684;&#x7EBF;&#x7A0B;&#x6302;&#x8D77;&#x6B21;&#x6570;</li>
<li>obj: &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#x7684;java&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;</li>
<li>self: &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5730;&#x5740;</li>
</ul>
<p>&#x7B2C;2&#x884C;&#xFF1A;</p>
<ul>
<li>sysTid&#xFF1A;&#x7EBF;&#x7A0B;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x4E0A;&#x7684;tid</li>
<li>nice: &#x8C03;&#x5EA6;&#x6709;&#x4F18;&#x5148;&#x7EA7;</li>
<li>cgrp: &#x8FDB;&#x7A0B;&#x6240;&#x5C5E;&#x7684;&#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x7EC4;</li>
<li>sched: &#x8C03;&#x5EA6;&#x7B56;&#x7565;</li>
<li>handle: &#x51FD;&#x6570;&#x5904;&#x7406;&#x5730;&#x5740;</li>
</ul>
<p>&#x7B2C;3&#x884C;&#xFF1A;</p>
<ul>
<li>state: &#x7EBF;&#x7A0B;&#x72B6;&#x6001;</li>
<li>schedstat: CPU&#x8C03;&#x5EA6;&#x65F6;&#x95F4;&#x7EDF;&#x8BA1;, &#x89C1;proc/[pid]/task/[tid]/schedstat</li>
<li>utm/stm: &#x7528;&#x6237;&#x6001;/&#x5185;&#x6838;&#x6001;&#x7684;CPU&#x65F6;&#x95F4;(&#x5355;&#x4F4D;&#x662F;jiffies), &#x89C1;proc/[pid]/task/[tid]/stat</li>
<li>core: &#x8BE5;&#x7EBF;&#x7A0B;&#x7684;&#x6700;&#x540E;&#x8FD0;&#x884C;&#x6240;&#x5728;&#x6838;</li>
<li>HZ: &#x65F6;&#x949F;&#x9891;&#x7387;</li>
</ul>
<p>&#x7B2C;4&#x884C;&#xFF1A;</p>
<ul>
<li>stack&#xFF1A;&#x7EBF;&#x7A0B;&#x6808;&#x7684;&#x5730;&#x5740;&#x533A;&#x95F4;</li>
<li>stackSize&#xFF1A;&#x6808;&#x7684;&#x5927;&#x5C0F;</li>
</ul>
<p>&#x7B2C;5&#x884C;&#xFF1A;</p>
<ul>
<li>mutex: &#x6240;&#x6301;&#x6709;mutex&#x7C7B;&#x578B;&#xFF0C;&#x6709;&#x72EC;&#x5360;&#x9501;exclusive&#x548C;&#x5171;&#x4EAB;&#x9501;shared&#x4E24;&#x7C7B;</li>
</ul>
<p><strong>schedstat&#x542B;&#x4E49;&#x8BF4;&#x660E;&#xFF1A;</strong></p>
<p><img src="media/3binder_cpu.png" alt="3binder_cpu"></p>
<p>nice&#x503C;&#x8D8A;&#x5C0F;&#x5219;&#x4F18;&#x5148;&#x7EA7;&#x8D8A;&#x9AD8;&#x3002;&#x6B64;&#x5904;nice=-2, &#x53EF;&#x89C1;&#x4F18;&#x5148;&#x7EA7;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;;</p>
<p>schedstat&#x62EC;&#x53F7;&#x4E2D;&#x7684;3&#x4E2A;&#x6570;&#x5B57;&#x4F9D;&#x6B21;&#x662F;Running&#x3001;Runable&#x3001;Switch&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x7684;&#x662F;utm&#x548C;stm</p>
<ul>
<li>Running&#x65F6;&#x95F4;&#xFF1A;CPU&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;ns</li>
<li>Runable&#x65F6;&#x95F4;&#xFF1A;RQ&#x961F;&#x5217;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;ns</li>
<li>Switch&#x6B21;&#x6570;&#xFF1A;CPU&#x8C03;&#x5EA6;&#x5207;&#x6362;&#x6B21;&#x6570;</li>
<li>utm: &#x8BE5;&#x7EBF;&#x7A0B;&#x5728;&#x7528;&#x6237;&#x6001;&#x6240;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x662F;jiffies&#xFF0C;jiffies&#x5B9A;&#x4E49;&#x4E3A;sysconf(_SC_CLK_TCK)&#xFF0C;&#x9ED8;&#x8BA4;&#x7B49;&#x4E8E;10ms</li>
<li>stm: &#x8BE5;&#x7EBF;&#x7A0B;&#x5728;&#x5185;&#x6838;&#x6001;&#x6240;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x662F;jiffies&#xFF0C;&#x9ED8;&#x8BA4;&#x7B49;&#x4E8E;10ms</li>
</ul>
<p>&#x53EF;&#x89C1;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;Running=186667489018ns,&#x4E5F;&#x7EA6;&#x7B49;&#x4E8E;186667ms&#x3002;&#x5728;CPU&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5305;&#x62EC;&#x7528;&#x6237;&#x6001;(utm)&#x548C;&#x5185;&#x6838;&#x6001;(stm)&#x3002; utm + stm = (12112 + 6554) &#xD7;10 ms = 186666ms&#x3002;</p>
<p>&#x7ED3;&#x8BBA;&#xFF1A;utm + stm = schedstat&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x503C;&#x3002;</p>
<h2 id="&#x53C2;&#x8003;"><a name="&#x53C2;&#x8003;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;"><i class="fa fa-link" aria-hidden="true"></i></a>1.7. &#x53C2;&#x8003;</h2>
<ul>
<li><a href="https://juejin.im/post/6844904069731975176" target="_blank">Android&#x8FDB;&#x9636;&#x77E5;&#x8BC6;&#xFF1A;ANR&#x7684;&#x5B9A;&#x4F4D;&#x4E0E;&#x89E3;&#x51B3;</a></li>
<li><a href="https://www.jianshu.com/p/3959a601cea6" target="_blank">ANR&#x95EE;&#x9898;&#x4E00;&#x822C;&#x89E3;&#x51B3;&#x601D;&#x8DEF;</a></li>
<li><a href="https://www.jianshu.com/p/1c827675f457" target="_blank">ANR&#xFF08;0&#xFF09;---&#x7406;&#x89E3;Android ANR&#x7684;&#x89E6;&#x53D1;&#x539F;&#x7406;</a></li>
<li><a href="https://www.jianshu.com/p/db198a499747" target="_blank">ANR&#xFF08;1&#xFF09;---&#x7406;&#x89E3;Android ANR&#x7684;&#x4FE1;&#x606F;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;</a></li>
<li><a href="https://www.jianshu.com/p/20b89d2a5853" target="_blank">ANR&#xFF08;3&#xFF09;---ART&#x865A;&#x62DF;&#x673A;&#x4E4B;Trace&#x539F;&#x7406;</a></li>
<li><a href="http://gityuan.com/2016/11/26/art-trace/" target="_blank">&#x89E3;&#x8BFB;Java&#x8FDB;&#x7A0B;&#x7684;Trace&#x6587;&#x4EF6;</a></li>
<li><a href="https://mp.weixin.qq.com/s/ApNSEWxQdM19QoCNijagtg" target="_blank">&#x4ECA;&#x65E5;&#x5934;&#x6761; ANR &#x4F18;&#x5316;&#x5B9E;&#x8DF5;&#x7CFB;&#x5217; - &#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x53CA;&#x5F71;&#x54CD;&#x56E0;&#x7D20;</a>--&#x3010;&#x4F18;&#x3011; </li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; tracyliu-FE 2021 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-03-16 10:10:22
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1.Android优化大全.html" class="navigation navigation-prev " aria-label="Previous page: 1.Android优化大全">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="11.启动优化.html" class="navigation navigation-next " aria-label="Next page: 11.启动优化">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"10.ANR","level":"1.9.3","depth":2,"next":{"title":"11.启动优化","level":"1.9.4","depth":2,"path":"Performance/11.启动优化.md","ref":"Performance/11.启动优化.md","articles":[]},"previous":{"title":"1.Android优化大全","level":"1.9.2","depth":2,"path":"Performance/1.Android优化大全.md","ref":"Performance/1.Android优化大全.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchor-navigation-ex","tbfed-pagefooter"],"ignores":["docs","_book","node_modules"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy tracyliu-FE 2021","modify_label":"文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"disableTitleFormatting":false,"variables":{},"title":"知识总结","gitbook":"*","outputfile":"SUMMARY.md"},"file":{"path":"Performance/10.ANR.md","mtime":"2021-03-16T02:10:22.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-02-23T02:32:04.631Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

